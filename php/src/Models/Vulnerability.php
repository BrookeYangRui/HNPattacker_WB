<?php

namespace HnpLab\PhpHnpAnalyzer\Models;

/**
 * 漏洞模型类
 */
class Vulnerability
{
    private $filePath;
    private $line;
    private $type;
    private $description;
    private $severity;
    private $timestamp;

    public function __construct(
        string $filePath,
        int $line,
        string $type,
        string $description,
        string $severity = 'high'
    ) {
        $this->filePath = $filePath;
        $this->line = $line;
        $this->type = $type;
        $this->description = $description;
        $this->severity = $severity;
        $this->timestamp = new \DateTime();
    }

    public function getFilePath(): string
    {
        return $this->filePath;
    }

    public function getLine(): int
    {
        return $this->line;
    }

    public function getType(): string
    {
        return $this->type;
    }

    public function getDescription(): string
    {
        return $this->description;
    }

    public function getSeverity(): string
    {
        return $this->severity;
    }

    public function getTimestamp(): \DateTime
    {
        return $this->timestamp;
    }

    public function toArray(): array
    {
        return [
            'file_path' => $this->filePath,
            'line' => $this->line,
            'type' => $this->type,
            'description' => $this->description,
            'severity' => $this->severity,
            'timestamp' => $this->timestamp->format('Y-m-d H:i:s')
        ];
    }

    public function __toString(): string
    {
        return sprintf(
            "[%s] %s:%d - %s (%s)",
            strtoupper($this->severity),
            basename($this->filePath),
            $this->line,
            $this->description,
            $this->type
        );
    }
}
