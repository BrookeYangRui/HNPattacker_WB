<!DOCTYPE html>
<html lang="en">
<head>
  <% include ad-header %>
  <title>LPC - Civilian Dashboard</title>
  <meta charset="utf-8">
  <meta name="description" content="Lines Roleplay Police CAD. Built to facilitate the needs of roleplay police and civilians." />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Favicon -->
  <link rel="shortcut icon" type="image/ico" href="static/images/favicon.ico">
  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
  <!-- Core CSS -->
  <link rel="stylesheet" href="/static/css/bootstrap.min.css" />
  <link rel="stylesheet" href="https://cdn.datatables.net/1.10.21/css/dataTables.bootstrap.min.css" />
  <link rel="stylesheet" href="/static/css/tail.select-dark.min.css" />
  <link rel="stylesheet" href="/static/css/awesomplete.css" />
    <!-- HeroUI Pro CSS -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@heroui/pro@1.0.0/dist/css/heroui-pro.min.css">
  <!-- Department Background System -->
  <link rel="stylesheet" href="/static/css/department-backgrounds.css">
  
  <!-- Google AdSense -->
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3842696805773142" crossorigin="anonymous"></script>
  
  <!-- Custom Styles -->
  <style>
    :root {
      --primary-color: #667eea;
      --primary-dark: #5a67d8;
      --secondary-color: #764ba2;
      --accent-color: #f093fb;
      --success-color: #48bb78;
      --warning-color: #ed8936;
      --danger-color: #f56565;
      --dark-bg: #1a202c;
      --darker-bg: #171923;
      --card-bg: #2d3748;
      --text-primary: #f7fafc;
      --text-secondary: #a0aec0;
      --border-color: #4a5568;
      --shadow-lg: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
      --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
    }
    
    /* Ad Styling for HeroUI Pro */
    .heroui-ad-container {
      margin: 2rem 0;
      text-align: center;
      background: #23263a;
      border-radius: 12px;
      padding: 1.5rem;
      box-shadow: 0 2px 8px 0 rgba(30,32,44,0.10);
      border: 1px solid #35385a;
      display: none; /* Hidden by default, shown by JavaScript based on subscription */
    }
    
    .heroui-ad-label {
      display: inline-block;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: #fff;
      font-size: 0.75rem;
      font-weight: 600;
      padding: 0.25rem 0.75rem;
      border-radius: 12px;
      margin-bottom: 1rem;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }
    
    .heroui-ad-content {
      min-height: 90px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    /* Responsive ad adjustments */
    @media (max-width: 768px) {
      .heroui-ad-container {
        margin: 1.5rem 0;
        padding: 1rem;
      }
    }
    
    /* Pagination Button Styling */
    .pagination-container {
      display: flex;
      justify-content: center;
      margin-top: 2rem;
    }
    
    .pagination {
      display: flex;
      list-style: none;
      margin: 0;
      padding: 0;
      gap: 0.5rem;
    }
    
    .pagination li {
      margin: 0;
    }
    
    .pagination a {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.75rem 1.5rem;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: #fff;
      text-decoration: none;
      border-radius: 8px;
      font-weight: 500;
      transition: all 0.2s ease;
      cursor: pointer;
      border: none;
      font-size: 1rem;
    }
    
    .pagination a:hover:not(:disabled) {
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
    }
    
    .pagination a:disabled {
      background: #4a5568 !important;
      color: #718096 !important;
      cursor: not-allowed !important;
      transform: none !important;
      box-shadow: none !important;
      opacity: 0.6;
    }
    
    .pagination a:disabled:hover {
      transform: none !important;
      box-shadow: none !important;
    }
    
    /* Specific styling for license pagination buttons */
    #prev-license-page-btn:disabled,
    #next-license-page-btn:disabled,
    #manage-prev-license-page-btn:disabled,
    #manage-next-license-page-btn:disabled {
      background: #4a5568 !important;
      color: #718096 !important;
      cursor: not-allowed !important;
      transform: none !important;
      box-shadow: none !important;
      opacity: 0.6;
    }
    
    #prev-license-page-btn:disabled:hover,
    #next-license-page-btn:disabled:hover,
    #manage-prev-license-page-btn:disabled:hover,
    #manage-next-license-page-btn:disabled:hover {
      transform: none !important;
      box-shadow: none !important;
    }
    
    /* Override button styles for vehicle and firearm management */
    button[onclick*="delinkVehicle"],
    button[onclick*="delinkFirearm"] {
      background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%) !important;
      color: #fff !important;
      border: none !important;
      border-radius: 8px !important;
      padding: 0.6rem 1.2rem !important;
      font-weight: 500 !important;
      cursor: pointer !important;
      width: 100% !important;
      margin-top: 0.5rem !important;
      transition: all 0.2s ease !important;
      font-size: 1rem !important;
      box-shadow: 0 4px 14px 0 rgba(239, 68, 68, 0.4) !important;
    }
    
    button[onclick*="linkVehicle"],
    button[onclick*="linkFirearm"] {
      background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%) !important;
      color: #fff !important;
      border: none !important;
      border-radius: 8px !important;
      padding: 0.6rem 1.2rem !important;
      font-weight: 500 !important;
      cursor: pointer !important;
      width: 100% !important;
      margin-top: 0.5rem !important;
      transition: all 0.2s ease !important;
      font-size: 1rem !important;
      box-shadow: 0 4px 14px 0 rgba(99, 102, 241, 0.4) !important;
    }
    html, body {
      background: var(--dark-bg);
    }

    * {
      box-sizing: border-box;
    }

    body {
      font-family: 'Inter', sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: var(--text-primary);
      margin: 0;
      padding: 0;
      min-height: 100vh;
      overflow-x: hidden;
    }



    /* HeroUI Pro Sidebar */
    .heroui-sidebar {
      position: fixed;
      top: 0;
      left: 0;
      height: 100vh;
      width: 280px;
      background: linear-gradient(180deg, var(--darker-bg) 0%, var(--dark-bg) 100%);
      box-shadow: var(--shadow-xl);
      z-index: 1000;
      overflow-y: auto;
      border-right: 1px solid var(--border-color);
      transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .heroui-sidebar.collapsed {
      width: 72px;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    
    .heroui-sidebar.collapsed .sidebar-text {
      opacity: 0;
      visibility: hidden;
      width: 0;
      overflow: hidden;
    }
    
    .heroui-sidebar.collapsed .sidebar-logo {
      gap: 0;
      justify-content: center;
    }

    /* Sidebar Header */
    .sidebar-header {
      padding: 2rem 1.5rem 1rem;
      border-bottom: 1px solid var(--border-color);
      background: rgba(255, 255, 255, 0.05);
    }

    .sidebar-logo {
  display: flex;
      align-items: center;
      gap: 0.75rem;
      margin-bottom: 1rem;
    }

    .sidebar-logo img {
      width: 40px;
      height: 40px;
      border-radius: 8px;
    }

    .sidebar-logo h2 {
      color: var(--text-primary);
      font-size: 1.5rem;
      font-weight: 700;
      margin: 0;
    }

    .heroui-sidebar.collapsed .sidebar-logo h2 {
      display: none;
    }

    /* User Profile */
    .user-profile {
      text-align: center;
      padding: 1.5rem;
    }

    .user-avatar {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      margin: 0 auto 1rem;
      background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 2rem;
      color: white;
      border: 3px solid rgba(255, 255, 255, 0.2);
      background-size: cover;
      background-position: center;
      overflow: hidden;
    }

    .heroui-sidebar.collapsed .user-avatar {
      width: 50px;
      height: 50px;
      font-size: 1.5rem;
      background-size: cover;
      background-position: center;
      overflow: hidden;
    }

    .user-name {
      color: var(--text-primary);
      font-size: 1.1rem;
      font-weight: 600;
      margin-bottom: 0.25rem;
    }

    .user-role {
      color: var(--text-secondary);
      font-size: 0.875rem;
    }

    .heroui-sidebar.collapsed .user-name,
    .heroui-sidebar.collapsed .user-role {
      display: none;
    }
    
    .heroui-sidebar.collapsed .user-profile {
      display: none;
    }
    
    /* Subscription Badge Styles */
    .subscription-badge {
      display: inline-flex;
      align-items: center;
      gap: 0.4rem;
      padding: 0.3rem 0.6rem;
      border-radius: 12px;
      font-size: 0.75rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      margin-top: 0.5rem;
      transition: all 0.2s ease;
    }
    
    .subscription-badge.premium-plus {
      background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
      color: #1f2937;
      box-shadow: 0 2px 8px rgba(251, 191, 36, 0.3);
    }
    
    .subscription-badge.premium-plus .subscription-plus {
      font-size: 0.9rem;
      font-weight: 700;
      margin-left: 0.1rem;
    }
    
    .subscription-badge.premium {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: #fff;
      box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);
    }
    
    .subscription-badge.basic {
      background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
      color: #fff;
      box-shadow: 0 2px 8px rgba(72, 187, 120, 0.3);
    }
    
    .subscription-badge.free {
      background: linear-gradient(135deg, #a0aec0 0%, #718096 100%);
      color: #fff;
      box-shadow: 0 2px 8px rgba(160, 174, 192, 0.3);
    }
    
    .heroui-sidebar.collapsed .subscription-badge {
      display: none;
    }

    /* Navigation */
    .sidebar-nav {
      padding: 1rem 0;
    }

    .nav-section {
      margin-bottom: 1.5rem;
    }

    .nav-section-title {
      color: var(--text-secondary);
      font-size: 1.1rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      padding: 0 1.5rem 0.5rem;
      margin-bottom: 0.5rem;
    }

    .heroui-sidebar.collapsed .nav-section-title {
      display: none;
    }

    .nav-item {
      margin: 0.25rem 0;
    }

    .nav-link {
      display: flex;
      align-items: center;
      padding: 0.75rem 1.5rem;
      color: var(--text-secondary);
      text-decoration: none;
      transition: all 0.2s ease;
      border-radius: 0 8px 8px 0;
      margin-right: 1rem;
      font-size: 1.15rem;
      min-height: 48px;
    }

    .heroui-sidebar.collapsed .nav-link {
      justify-content: center;
      padding: 0.75rem 0.5rem;
      margin-right: 0.5rem;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .nav-link:hover {
      background: rgba(255, 255, 255, 0.1);
      color: var(--text-primary);
      transform: translateX(4px);
    }

    .heroui-sidebar.collapsed .nav-link:hover {
      transform: none;
    }

    .nav-link.active {
      background: linear-gradient(90deg, var(--primary-color) 0%, var(--secondary-color) 100%);
      color: var(--text-primary);
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
    }

    .nav-icon {
      width: 20px;
      margin-right: 0.75rem;
      font-size: 1.4rem;
    }

    .heroui-sidebar.collapsed .nav-icon {
      margin: 0;
      font-size: 1.6rem;
  display: flex;
  align-items: center;
  justify-content: center;
    }

    .nav-text {
      font-weight: 500;
      font-size: 1rem;
    }

    .heroui-sidebar.collapsed .nav-text {
      display: none;
    }

    /* Collapsible sections - expanded by default */
    .nav-toggle {
      width: 100%;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0.75rem 1.5rem;
      color: var(--text-secondary);
      background: none;
      border: none;
      cursor: pointer;
      transition: all 0.2s ease;
      border-radius: 0 8px 8px 0;
      margin-right: 1rem;
    }

    .heroui-sidebar.collapsed .nav-toggle {
      justify-content: center;
      padding: 0.75rem 0.5rem;
      margin-right: 0.5rem;
    }

    .nav-toggle:hover {
      background: rgba(255, 255, 255, 0.1);
      color: var(--text-primary);
    }

    .nav-toggle .caret {
      transition: transform 0.2s ease;
    }

    .nav-toggle.open .caret {
      transform: rotate(180deg);
    }

    .heroui-sidebar.collapsed .nav-toggle .caret {
      display: none;
    }

    .nav-submenu {
      max-height: 500px;
      overflow: hidden;
      transition: max-height 0.3s ease;
    }

    .nav-submenu.collapsed {
      max-height: 0;
    }

    .nav-submenu .nav-link {
      padding-left: 3rem;
      font-size: 0.9rem;
    }

    .heroui-sidebar.collapsed .nav-submenu {
    display: none;
}

    /* Mobile overlay */
    .sidebar-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      z-index: 999;
      opacity: 0;
      visibility: hidden;
      transition: all 0.3s ease;
    }

    .sidebar-overlay.open {
      opacity: 1;
      visibility: visible;
    }

    /* Mobile toggle button */
    .mobile-toggle {
    position: fixed;
      top: 1rem;
      left: 1rem;
      z-index: 1001;
      background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
      border: none;
    border-radius: 8px;
      padding: 0.75rem;
      color: white;
      cursor: pointer;
      box-shadow: var(--shadow-lg);
      transition: all 0.2s ease;
    }

    .mobile-toggle:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 16px rgba(0, 0, 0, 0.4);
    }

    /* Sidebar collapse button */
    .sidebar-collapse-btn {
      position: absolute;
      top: 1rem;
      right: -12px;
      background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
      border: none;
      border-radius: 50%;
      width: 24px;
      height: 24px;
      color: white;
      cursor: pointer;
    display: flex;
    align-items: center;
      justify-content: center;
      font-size: 0.8rem;
      box-shadow: var(--shadow-lg);
      transition: all 0.2s ease;
      z-index: 1002;
    }

    .sidebar-collapse-btn:hover {
      transform: scale(1.1);
    }

    /* Main content */
    .main-content {
      margin-left: 280px;
      transition: margin-left 0.3s ease;
      min-height: 100vh;
      background: var(--dark-bg);
    }

    .main-content.sidebar-collapsed {
      margin-left: 72px;
    }

    /* Top Navigation */
    .top-nav {
      background: rgba(45, 55, 72, 0.95);
      backdrop-filter: blur(10px);
      border-bottom: 1px solid var(--border-color);
      padding: 1rem 0;
      position: sticky;
      top: 0;
      z-index: 100;
    }

    .top-nav h1 {
      margin: 0;
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--text-primary);
    }

    .top-nav a {
      color: var(--text-primary);
      text-decoration: none;
    }

    /* Search Section */
    .search-section {
      background: var(--card-bg);
      border-radius: 12px;
      padding: 2rem;
      margin: 2rem 0;
      box-shadow: var(--shadow-lg);
      border: 1px solid var(--border-color);
    }

    .search-container {
      max-width: 600px;
      margin: 0 auto;
    }

    .search-container label {
      display: block;
      margin-bottom: 0.5rem;
      font-weight: 500;
      color: var(--text-primary);
    }

    .search-container input {
      width: 100%;
      padding: 1rem 1.5rem;
      border: 2px solid var(--border-color);
      border-radius: 8px;
      background: var(--dark-bg);
      color: var(--text-primary);
      font-size: 1rem;
      transition: all 0.2s ease;
    }

    .search-container input:focus {
      outline: none;
      border-color: var(--primary-color);
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }

    /* Content Sections */
    .content-section {
      background: var(--card-bg);
      border-radius: 12px;
      padding: 2rem;
      margin: 2rem 0;
      box-shadow: var(--shadow-lg);
      border: 1px solid var(--border-color);
    }

    .section-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1.5rem;
      padding-bottom: 1rem;
      border-bottom: 1px solid var(--border-color);
    }

    .section-title {
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--text-primary);
      margin: 0;
    }

    .btn-primary {
      background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
      border: none;
      border-radius: 8px;
      padding: 0.75rem 1.5rem;
      color: white;
      font-weight: 500;
      text-decoration: none;
      transition: all 0.2s ease;
      box-shadow: var(--shadow-lg);
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);
      color: white;
      text-decoration: none;
    }

    /* Loading Animation */
    .loading-spinner {
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 2rem;
    }

    .spinner {
      width: 40px;
      height: 40px;
      border: 4px solid var(--border-color);
      border-top: 4px solid var(--primary-color);
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    /* Cards Grid */
    .cards-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 1.5rem;
      margin-top: 1.5rem;
    }

    .card {
      background: var(--dark-bg);
      border-radius: 12px;
      padding: 1.5rem;
      border: 1px solid var(--border-color);
      transition: all 0.2s ease;
      cursor: pointer;
    }

    .card:hover {
      transform: translateY(-4px);
      box-shadow: var(--shadow-xl);
      border-color: var(--primary-color);
    }

    .card-header {
      display: flex;
      align-items: center;
      margin-bottom: 1rem;
    }

    .card-avatar {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      margin-right: 1rem;
      background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: 600;
    }

    .card-title {
      font-size: 1.1rem;
      font-weight: 600;
      color: var(--text-primary);
      margin: 0;
    }

    .card-subtitle {
      font-size: 0.875rem;
      color: var(--text-secondary);
      margin: 0;
    }

    .card-content {
      color: var(--text-secondary);
      font-size: 0.875rem;
      line-height: 1.5;
    }

    /* Pagination */
    .pagination-container {
      display: flex;
      justify-content: center;
      margin-top: 2rem;
    }

    .pagination {
      display: flex;
      gap: 0.5rem;
      list-style: none;
      margin: 0;
      padding: 0;
    }

    .pagination li a {
      display: flex;
      align-items: center;
      padding: 0.75rem 1rem;
      background: var(--card-bg);
      color: var(--text-primary);
      text-decoration: none;
      border-radius: 8px;
      border: 1px solid var(--border-color);
      transition: all 0.2s ease;
    }

    .pagination li a:hover {
      background: var(--primary-color);
      border-color: var(--primary-color);
      transform: translateY(-2px);
    }

    .pagination li.disabled a {
      opacity: 0.5;
      cursor: not-allowed;
      pointer-events: none;
    }

    /* Notification badge pill */
    .notification-badge {
      position: static !important;
      display: inline-block !important;
      margin-left: 0.5rem;
      background: #f56565;
      color: #fff;
      border-radius: 999px;
      min-width: 22px;
      height: 22px;
      font-size: 0.95rem;
      line-height: 22px;
      text-align: center;
      font-weight: 700;
      vertical-align: middle;
      box-shadow: 0 1px 4px rgba(0,0,0,0.12);
    }

    /* Toast notifications */
    .toast-container {
      position: fixed;
      top: 20px;
      right: 20px;
      z-index: 9999;
    }

    .toast {
      background: var(--card-bg);
      color: var(--text-primary);
      border-radius: 8px;
      padding: 1rem;
      margin-bottom: 0.5rem;
      box-shadow: var(--shadow-xl);
      border: 1px solid var(--border-color);
      min-width: 300px;
    }

    /* Responsive */
    @media (max-width: 768px) {
      .heroui-sidebar {
        transform: translateX(-100%);
        width: 100%;
        max-width: 320px;
      }

      .heroui-sidebar.open {
        transform: translateX(0);
      }

      .main-content {
        margin-left: 0;
      }

      .main-content.sidebar-collapsed {
        margin-left: 0;
      }

      .mobile-toggle {
        display: block;
      }

      .sidebar-collapse-btn {
        display: none;
      }

      .cards-grid {
        grid-template-columns: 1fr;
      }

      .section-header {
        flex-direction: column;
        gap: 1rem;
        align-items: flex-start;
      }
    }

    @media (min-width: 769px) {
      .mobile-toggle {
        display: none;
      }

      .sidebar-collapse-btn {
        display: flex;
      }
    }

    /* Hide Google Translate */
    iframe.goog-te-banner-frame {
      display: none !important;
    }

    body {
      position: static !important;
      top: 0px !important;
    }

    @media (max-width: 600px) {
      #civDetailsModal .heroui-modal-close {
        position: absolute;
        top: 0.75rem;
        right: 1rem;
        z-index: 10;
        font-size: 2rem;
        background: none;
        border: none;
        color: #fff;
        padding: 0.5rem 1rem;
        border-radius: 50%;
        box-shadow: 0 2px 8px 0 rgba(30,32,44,0.10);
        transition: background 0.2s;
      }
      #civDetailsModal .heroui-modal-close:active,
      #civDetailsModal .heroui-modal-close:focus {
        background: #23263a;
        outline: none;
      }
      #civDetailsModal .heroui-modal-tabs {
        margin-top: 3.5rem !important;
      }
    }
  </style>
  <style>
    @media (max-width: 768px) {
      .top-nav {
        display: none !important;
      }
    }
  </style>
  <style>
    @media (min-width: 769px) {
      #lpc-footer {
        margin-left: 280px;
      }
    }
    @media (max-width: 768px) {
      #lpc-footer {
        margin-left: 0;
      }
    }
  </style>
</head>

<body>
  <!-- Mobile Header Bar (HeroUI Pro style) -->
  <div class="mobile-header" style="display:none; position:fixed; top:0; left:0; width:100vw; height:56px; background:linear-gradient(90deg,#23263a 0%,#35385a 100%); z-index:1102; align-items:center; box-shadow:0 2px 8px rgba(30,32,44,0.10);">
    <button class="mobile-toggle" id="mobileToggle" style="margin-left:1rem; background:linear-gradient(135deg,#667eea 0%,#764ba2 100%); border:none; border-radius:8px; width:40px; height:40px; color:#fff; display:flex; align-items:center; justify-content:center; font-size:1.3rem; box-shadow:0 2px 8px rgba(102,126,234,0.10); cursor:pointer;">
      <i class="fa fa-bars"></i>
    </button>
    <div style="margin-left:1.2rem; display:flex; flex-direction:column; align-items:flex-start;">
      <span id="dashboard-title" style="font-size:1.15rem; font-weight:700; color:#f7fafc; letter-spacing:0.01em;"><%= departmentName || 'Civilian Dashboard' %></span>
      <span id="mobile-community-name" style="font-size:0.9rem; font-weight:600; background: linear-gradient(135deg, #a78bfa 0%, #c084fc 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; letter-spacing:0.01em;"></span>
    </div>
  </div>

  <!-- Sidebar Overlay -->
  <div class="sidebar-overlay" id="sidebarOverlay"></div>

  <!-- HeroUI Pro Sidebar -->
  <nav class="heroui-sidebar" id="herouiSidebar">
    <!-- Sidebar Header -->
    <div class="sidebar-header" style="display: flex; align-items: center; justify-content: space-between;">
              <div class="sidebar-logo" style="display: flex; align-items: center; gap: 0.75rem;">
          <img src="/static/images/lpc-logo.svg?v=2" alt="LPC Logo" style="width:40px;height:40px;">
          <span class="sidebar-text" style="font-size: 1.1rem; font-weight: 600; color: #fff; letter-spacing: 0.02em; transition: opacity 0.3s ease;">Lines Police CAD</span>
        </div>
      <button id="sidebarCollapseBtn" aria-label="Toggle sidebar" style="margin-left:auto; display:none; background: #23263a; border: 1px solid #44475a; border-radius: 6px; width: 32px; height: 32px; display: flex; align-items: center; justify-content: center; transition: background 0.2s, border 0.2s;">
        <i class="fa fa-chevron-left" id="sidebarCollapseIcon" style="color: #fff; font-size: 1.2rem;"></i>
      </button>
      <style>
        #sidebarCollapseBtn:hover {
          background: #35385a;
          border-color: #667eea;
        }
      </style>
            </div>

    <!-- User Profile -->
    <div class="user-profile">
      <div class="user-avatar" id="sidebarUserAvatar">
        <i class="fa fa-user" id="sidebarUserIcon"></i>
      </div>
      <div class="user-name">
        <%=user.user.username%>
      </div>
      <div class="user-role"><%= user.user.role || 'Civilian' %></div>
      <div id="subscription-badge" class="subscription-badge" style="display: none;">
        <i class="fa fa-crown"></i>
        <span id="subscription-text">Premium</span>
      </div>
    </div>

    <!-- Navigation -->
    <div class="sidebar-nav">
      <!-- Main -->
      <div class="nav-section">
        <div class="nav-section-title">Main</div>
        <div class="nav-item">
          <a href="/" class="nav-link active">
            <i class="fa fa-home nav-icon"></i>
            <span class="nav-text">Dashboard</span>
          </a>
  </div>
</div>

      <!-- Operations -->
      <div class="nav-section">
        <div class="nav-section-title">Operations</div>
        <div class="nav-item">
          <a onclick="openNewCivModal()" class="nav-link" style="cursor: pointer;">
            <i class="fa fa-id-card nav-icon"></i>
            <span class="nav-text">Add New Civilian</span>
          </a>
        </div>
        <div class="nav-item">
          <a onclick="openNewVehicleModal()" class="nav-link" style="cursor: pointer;">
            <i class="fa fa-car nav-icon"></i>
            <span class="nav-text">Add New Vehicle</span>
          </a>
        </div>
        <div class="nav-item">
          <a onclick="openNewFirearmModal()" class="nav-link" style="cursor: pointer;">
            <i class="fa fa-crosshairs nav-icon"></i>
            <span class="nav-text">Add New Firearm</span>
          </a>
        </div>
      </div>
            
      <!-- Utilities -->
      <div class="nav-section">
        <div class="nav-section-title">Utilities</div>
        <div class="nav-item">
          <a onclick="openCall911Modal()" class="nav-link" style="cursor: pointer;">
            <i class="fa fa-exclamation-triangle nav-icon"></i>
            <span class="nav-text">Call 911</span>
          </a>
              </div>
        <div class="nav-item">
          <a href="/map-interactive" class="nav-link">
            <i class="fa fa-map nav-icon"></i>
            <span class="nav-text">Map</span>
            <i class="fa fa-external-link-alt" style="margin-left: auto; font-size: 0.8rem;"></i>
          </a>
  </div>
</div>

      <!-- Departments -->
      <div class="nav-section">
        <div class="nav-section-title">Departments</div>
        <div id="departmentsSubmenu">
          <!-- Dynamic departments will be loaded here by modern-departments.js -->
        </div>
      </div>

      <!-- Communities -->
      <div class="nav-section">
        <div class="nav-section-title">Communities</div>
        <div class="nav-item">
          <a href="/community-dashboard" class="nav-link">
            <i class="fa fa-house-user nav-icon"></i>
            <span class="nav-text">Community Dashboard</span>
          </a>
              </div>
        <div class="nav-item">
          <a href="/communities" class="nav-link">
            <i class="fa fa-square-plus nav-icon"></i>
            <span class="nav-text">Communities</span>
          </a>
              </div>
            </div>

      <!-- Other -->
      <div class="nav-section">
        <div class="nav-section-title">Other</div>
        <div class="nav-item">
          <a onclick="openNotificationModal()" class="nav-link" style="cursor: pointer;">
            <i class="fa fa-bell nav-icon"></i>
            <span class="nav-text">Notifications</span>
            <span id="notification-count" class="notification-badge"></span>
          </a>
              </div>
        <div class="nav-item">
          <a onclick="openAccountModal()" class="nav-link" style="cursor: pointer;">
            <i class="fa fa-cog nav-icon"></i>
            <span class="nav-text">Settings</span>
          </a>
            </div>
        <div class="nav-item">
          <a href="/contact-us" class="nav-link">
            <i class="fa fa-life-ring nav-icon"></i>
            <span class="nav-text">Support</span>
            <i class="fa fa-external-link-alt" style="margin-left: auto; font-size: 0.8rem;"></i>
          </a>
              </div>
        <div class="nav-item">
          <a href="/logout" class="nav-link">
            <i class="fa fa-sign-out nav-icon"></i>
            <span class="nav-text">Sign Out</span>
          </a>
            </div>
              </div>
            </div>
  </nav>

  <!-- Main Content -->
  <div class="main-content" id="mainContent">
    <!-- Top Navigation -->
    <nav class="top-nav">
      <div class="container-fluid">
        <h1><a href="/civ-dashboard"><i class="fa fa-user"></i> <span id="main-dashboard-title"><%= departmentName || 'Civilian Dashboard' %></span></a> • <a href="/community-dashboard"><span id="community-name" style="background: linear-gradient(135deg, #a78bfa 0%, #c084fc 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; font-weight: 600;"></span></a></h1>
              </div>
    </nav>

    <!-- Community Alerts -->
    <% include community-alerts %>
    
    <!-- 911 Call Alert -->
    <div id="911CallCreatedAlert" class="alert alert-success alert-dismissible hide" role="alert">
      <strong>Success!</strong> 911 Call has been placed
            <button type="button" class="close" data-dismiss="alert" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>

    <!-- Page Content -->
    <div class="container-fluid" style="padding: 2rem;">
      <!-- HeroUI Promo/Announcement Bar -->
      <div id="promo-bar" class="heroui-alert heroui-alert-info" style="display: flex; align-items: center; justify-content: space-between; background: linear-gradient(90deg, #667eea 0%, #764ba2 100%); color: #fff; border-radius: 10px; box-shadow: 0 4px 16px rgba(102,126,234,0.10); padding: 1.25rem 2rem 1.25rem 1.5rem; margin-bottom: 2rem;">
        <div style="display: flex; align-items: center; gap: 1.25rem;">
          <i class="fa fa-lightbulb" style="font-size: 1.7rem; color: #f7fafc;"></i>
          <div>
            <div style="font-size: 1.15rem; font-weight: 600; letter-spacing: 0.01em;">Tips & Tricks</div>
            <div style="font-size: 1rem; color: #e0e7ff; margin-top: 0.15rem;">
              Did you know? You can quickly add a new civilian, vehicle, or firearm using the <b>+ Add</b> buttons below!<br>
              Need help or want to give feedback? <a href="https://discord.gg/3ECFhqe" target="_blank" rel="noopener" style="color: #f093fb; text-decoration: underline; font-weight: 500;">Join our Discord</a> or check out the <a href="/faq" style="color: #f093fb; text-decoration: underline; font-weight: 500;">FAQ</a>.
            </div>
          </div>
        </div>
        <div style="display: flex; align-items: center; gap: 1.2rem;">
          <a id="promo-bar-hide" href="#" style="color: #f093fb; font-size: 1rem; text-decoration: underline; font-weight: 500; opacity: 0.85;">Don't show again</a>
          <button id="promo-bar-close" aria-label="Close" style="background: none; border: none; color: #fff; font-size: 1.5rem; margin-left: 0.5rem; cursor: pointer; opacity: 0.7; transition: opacity 0.2s;">
            <i class="fa fa-times"></i>
          </button>
        </div>
      </div>
      <script>
        function setPromoBarCookie() {
          document.cookie = 'hidePromoBar=true; path=/; max-age=31536000'; // 1 year
        }
        function getPromoBarCookie() {
          return document.cookie.split(';').some(c => c.trim().startsWith('hidePromoBar='));
        }
        document.addEventListener('DOMContentLoaded', function() {
          if (getPromoBarCookie()) {
            var bar = document.getElementById('promo-bar');
            if (bar) bar.style.display = 'none';
            return;
          }
          var closeBtn = document.getElementById('promo-bar-close');
          if (closeBtn) {
            closeBtn.addEventListener('click', function() {
              var bar = document.getElementById('promo-bar');
              if (bar) bar.style.display = 'none';
            });
          }
          var hideBtn = document.getElementById('promo-bar-hide');
          if (hideBtn) {
            hideBtn.addEventListener('click', function(e) {
              e.preventDefault();
              setPromoBarCookie();
              var bar = document.getElementById('promo-bar');
              if (bar) bar.style.display = 'none';
            });
          }
        });
      </script>

      <!-- Display Ad - Top Banner -->
      <div class="heroui-ad-container" style="margin: 2rem 0; text-align: center; background: #23263a; border-radius: 12px; padding: 1.5rem; box-shadow: 0 2px 8px 0 rgba(30,32,44,0.10); border: 1px solid #35385a;">
        <div style="display: inline-block; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: #fff; font-size: 0.75rem; font-weight: 600; padding: 0.25rem 0.75rem; border-radius: 12px; margin-bottom: 1rem; text-transform: uppercase; letter-spacing: 0.05em;">Advertisement</div>
        <div style="width: 100%; min-height: 90px; display: flex; align-items: center; justify-content: center;">
          <ins class="adsbygoogle"
               style="display:block; width: 728px; height: 90px;"
               data-ad-client="ca-pub-3842696805773142"
               data-ad-slot="1673838381"></ins>
          <script>
               (adsbygoogle = window.adsbygoogle || []).push({});
          </script>
        </div>
      </div>       

      <!-- Civilians Section -->
      <div class="content-section">
        <div class="section-header">
          <h2 class="section-title">Civilians</h2>
          <button onclick="openNewCivModal()" class="btn-primary">
            <i class="fa fa-plus"></i> Add New Civilian
          </button>
                    </div>
        <!-- Loading State -->
        <div id="civilians-loading" class="loading-spinner">
          <div class="spinner"></div>
                  </div>
        <!-- Civilians Grid -->
        <div id="personas-thumbnail" class="cards-grid" style="display: none;">
          <!-- Dynamic content will be loaded here -->
                  </div>
        <!-- Error States -->
        <div id="issue-loading-personnel-alert" style="display: none;">
          <p class="text-center" style="color: var(--warning-color); font-style: italic;">
            ⚠️ Issue loading civilians, try refreshing the page...
          </p>
                  </div>
        <div id="no-civilians-found-alert" style="display: none;">
          <p class="text-center" style="color: var(--text-secondary); font-style: italic;">
            No civilians found, try adding one...
          </p>
                  </div>
                <!-- Pagination -->
        <div class="pagination-container">
          <ul class="pagination">
            <li><a id="prev-civ-page-btn">
                <i class="fa fa-chevron-left"></i> Previous
              </a></li>
            <li><a id="next-civ-page-btn">
                Next <i class="fa fa-chevron-right"></i>
              </a></li>
          </ul>
        </div>
                  </div>

      <!-- Vehicles Section -->
      <div class="content-section">
        <div class="section-header">
          <h2 class="section-title">Vehicles</h2>
          <button data-toggle="modal" href="#newVehicleModal" class="btn-primary">
            <i class="fa fa-plus"></i> Add New Vehicle
          </button>
                </div>
        <!-- Loading State -->
        <div id="vehicles-loading" class="loading-spinner">
          <div class="spinner"></div>
                </div>
        <!-- Vehicles Grid -->
        <div id="vehicles-thumbnail" class="cards-grid" style="display: none;">
          <!-- Dynamic content will be loaded here -->
                </div>
        <!-- Error States -->
        <div id="issue-loading-vehicles-alert" style="display: none;">
          <p class="text-center" style="color: var(--warning-color); font-style: italic;">
            ⚠️ Issue loading vehicles, try refreshing the page...
          </p>
                </div>
        <div id="no-vehicles-found-alert" style="display: none;">
          <p class="text-center" style="color: var(--text-secondary); font-style: italic;">
            No vehicles found, try adding one...
          </p>
                </div>
                <!-- Pagination -->
        <div class="pagination-container">
          <ul class="pagination">
            <li><a id="prev-veh-page-btn">
                <i class="fa fa-chevron-left"></i> Previous
              </a></li>
            <li><a id="next-veh-page-btn">
                Next <i class="fa fa-chevron-right"></i>
              </a></li>
          </ul>
        </div>
  </div>

      <!-- Firearms Section -->
      <div class="content-section">
        <div class="section-header">
          <h2 class="section-title">Firearms</h2>
          <button onclick="openNewFirearmModal()" class="btn-primary">
            <i class="fa fa-plus"></i> Add New Firearm
          </button>
      </div>
        <!-- Loading State -->
        <div id="firearms-loading" class="loading-spinner">
          <div class="spinner"></div>
      </div>
        <!-- Firearms Grid -->
        <div id="firearms-thumbnail" class="cards-grid" style="display: none;">
          <!-- Dynamic content will be loaded here -->
        </div>
        <!-- Error States -->
        <div id="issue-loading-firearms-alert" style="display: none;">
          <p class="text-center" style="color: var(--warning-color); font-style: italic;">
            ⚠️ Issue loading firearms, try refreshing the page...
          </p>
      </div>
        <div id="no-firearms-found-alert" style="display: none;">
          <p class="text-center" style="color: var(--text-secondary); font-style: italic;">
            No firearms found, try adding one...
          </p>
      </div>
        <!-- Pagination -->
        <div class="pagination-container">
          <ul class="pagination">
            <li><a id="prev-gun-page-btn">
                <i class="fa fa-chevron-left"></i> Previous
              </a></li>
            <li><a id="next-gun-page-btn">
                Next <i class="fa fa-chevron-right"></i>
              </a></li>
          </ul>
        </div>
      </div>
    </div>
  </div>

  <!-- Display Ad - Bottom Banner -->
  <div class="heroui-ad-container" style="margin: 3rem 0 2rem 0; text-align: center; background: #23263a; border-radius: 12px; padding: 1.5rem; box-shadow: 0 2px 8px 0 rgba(30,32,44,0.10); border: 1px solid #35385a;">
    <div style="display: inline-block; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: #fff; font-size: 0.75rem; font-weight: 600; padding: 0.25rem 0.75rem; border-radius: 12px; margin-bottom: 1rem; text-transform: uppercase; letter-spacing: 0.05em;">Advertisement</div>
    <div style="width: 100%; min-height: 90px; display: flex; align-items: center; justify-content: center;">
      <ins class="adsbygoogle"
           style="display:block; width: 728px; height: 90px;"
           data-ad-client="ca-pub-3842696805773142"
           data-ad-slot="1760139308"></ins>
      <script>
           (adsbygoogle = window.adsbygoogle || []).push({});
      </script>
    </div>
  </div>

  <!-- Modals -->

  <!-- Toast Container -->
  <div class="toast-container" id="toast-container"></div>

  <!-- Keep all existing modals and content -->
  <div id="galleryModal" class="modal fade" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-body">
          <img src="" id="galleryImage" class="img-responsive" />
          <p>
            <br />
            <button class="btn btn-primary btn-lg center-block" data-dismiss="modal" aria-hidden="true">Close <i class="ion-android-close"></i></button>
          </p>
        </div>
      </div>
    </div>
  </div>

  <!-- HeroUI Civilian Details Modal -->
  <div id="civDetailsModal" class="heroui-modal" style="display:none; position:fixed; z-index:2000; left:0; top:0; width:100vw; height:100vh; background:rgba(30,32,44,0.65); align-items:center; justify-content:center;">
    <div class="heroui-modal-content" style="background:#23263a; border-radius:16px; max-width:700px; width:98%; margin:auto; box-shadow:0 8px 32px rgba(0,0,0,0.25); padding:2.5rem 2rem 2rem 2rem; position:relative; max-height:90vh; overflow-y:auto;">
      <div class="heroui-modal-close-row-mobile" style="width:100%;display:block;text-align:right;margin-bottom:1.5rem;">
        <button class="heroui-modal-close" id="civDetailsModalClose" aria-label="Close" style="font-size:2rem;background:none;border:none;color:#fff;z-index:10;">&times;</button>
      </div>
      <div class="heroui-tabs" style="display:flex; gap:1.2rem; border-bottom:1.5px solid #35385a; margin-bottom:2rem;">
        <button class="heroui-tab active" data-tab="edit" style="background:none; border:none; color:#fff; font-size:1.1rem; font-weight:600; padding:0.5rem 1.2rem; border-radius:8px 8px 0 0; cursor:pointer;">Edit Civilian</button>
        <button class="heroui-tab" data-tab="vehicles" style="background:none; border:none; color:#a0aec0; font-size:1.1rem; font-weight:600; padding:0.5rem 1.2rem; border-radius:8px 8px 0 0; cursor:pointer;">Manage Vehicles</button>
        <button class="heroui-tab" data-tab="firearms" style="background:none; border:none; color:#a0aec0; font-size:1.1rem; font-weight:600; padding:0.5rem 1.2rem; border-radius:8px 8px 0 0; cursor:pointer;">Manage Firearms</button>
        <button class="heroui-tab" data-tab="licenses" style="background:none; border:none; color:#a0aec0; font-size:1.1rem; font-weight:600; padding:0.5rem 1.2rem; border-radius:8px 8px 0 0; cursor:pointer;">Licenses</button>
        <button class="heroui-tab" data-tab="records" style="background:none; border:none; color:#a0aec0; font-size:1.1rem; font-weight:600; padding:0.5rem 1.2rem; border-radius:8px 8px 0 0; cursor:pointer;">Records</button>
      </div>
      <!-- Tab Content -->
      <div class="heroui-tab-content" id="civTabContent-edit" style="display: block;">
        <!-- Edit Civilian Form -->
        <form id="editCivilianForm" autocomplete="off">
          <input type="hidden" id="civIdHidden" />
          <div style="display:flex; gap:2rem; align-items:flex-start; flex-wrap:wrap;">
            <div style="flex:1 1 220px; min-width:220px;">
              <div id="civAvatarUpload" style="width:90px; height:90px; border-radius:50%; background:linear-gradient(135deg,#667eea 0%,#764ba2 100%); display:flex; align-items:center; justify-content:center; font-size:2.5rem; color:#fff; margin-bottom:1.2rem; position:relative; cursor:pointer; transition:box-shadow 0.2s; box-shadow:0 2px 8px rgba(102,126,234,0.10); overflow:hidden;">
                <img id="civAvatarImg" src="" alt="Avatar" style="display:none; width:100%; height:100%; object-fit:cover; border-radius:50%; position:absolute; left:0; top:0;" />
                <span id="civAvatarInitials">MS</span>
                <span style="position:absolute; bottom:8px; right:8px; background:rgba(30,32,44,0.85); border-radius:50%; padding:7px; display:flex; align-items:center; justify-content:center; transition:background 0.2s;">
                  <i class="fa fa-camera" style="font-size:1.55rem; color:#f7fafc;"></i>
                </span>
                <input type="file" id="civImageInput" accept="image/*" style="display:none;" />
              </div>
              <div style="font-size:1.1rem; color:#a0aec0; margin-bottom:0.5rem;">Profile Photo</div>
            </div>
            <div style="flex:2 1 320px; min-width:260px;">
              <div style="font-size:1.2rem; font-weight:600; color:#f7fafc; margin-bottom:0.7rem;">Details about your Civilian</div>
              <div style="display:flex; gap:1.2rem; flex-wrap:wrap;">
                <div style="flex:1 1 180px; min-width:160px; margin-bottom:1rem;">
                  <label for="civName" style="color:#e0e7ff; font-weight:500;">Name*</label>
                  <input id="civName" name="name" type="text" class="heroui-input civ-input" style="width:100%; margin-top:0.2rem;" required placeholder="Name" />
                </div>
                <div style="flex:1 1 140px; min-width:120px; margin-bottom:1rem;">
                  <label for="civDOB" style="color:#e0e7ff; font-weight:500;">Date of Birth*</label>
                  <input id="civDOB" name="dob" type="date" class="heroui-input civ-input" style="width:100%; margin-top:0.2rem;" required placeholder="YYYY-MM-DD" />
                </div>
                <div style="flex:1 1 80px; min-width:80px; margin-bottom:1rem;">
                  <label for="civAge" style="color:#e0e7ff; font-weight:500;">Age</label>
                  <input id="civAge" name="age" type="number" class="heroui-input civ-input" style="width:100%; margin-top:0.2rem;" readonly placeholder="Age" />
                </div>
              </div>
              <div style="display:flex; gap:1.2rem; flex-wrap:wrap;">
                <div style="flex:2 1 220px; min-width:180px; margin-bottom:1rem;">
                  <label for="civAddress" style="color:#e0e7ff; font-weight:500;">Address</label>
                  <input id="civAddress" name="address" type="text" class="heroui-input civ-input" style="width:100%; margin-top:0.2rem;" placeholder="Address" />
                </div>
                <div style="flex:2 1 180px; min-width:140px; margin-bottom:1rem;">
                  <label for="civOccupation" style="color:#e0e7ff; font-weight:500;">Occupation</label>
                  <input id="civOccupation" name="occupation" type="text" class="heroui-input civ-input" style="width:100%; margin-top:0.2rem;" placeholder="Occupation" />
                </div>
              </div>
              <div style="font-size:1.1rem; color:#a0aec0; margin-bottom:0.5rem; margin-top:1.2rem;">Advanced Details <span style="font-size:0.95rem; color:#888;">(Optional)</span></div>
              <div style="display:flex; gap:1.2rem; flex-wrap:wrap;">
                <div style="flex:1 1 120px; min-width:100px; margin-bottom:1rem;">
                  <label for="civGender" style="color:#e0e7ff; font-weight:500;">Gender</label>
                  <select id="civGender" name="gender" class="heroui-input civ-input" style="width:100%; margin-top:0.2rem;" placeholder="Gender">
                    <option value="">Select</option>
                    <option value="Male">Male</option>
                    <option value="Female">Female</option>
                    <option value="Other">Other</option>
                  </select>
                </div>
                <!-- Height Section -->
                <div style="margin-bottom: 1.5rem;">
                  <label style="color:#e0e7ff; font-weight:500; display:block; margin-bottom:0.5rem;">Height</label>
                  <div style="display: flex; background:#1e2028; border:1.5px solid #35385a; border-radius:8px; padding:0.25rem; margin-bottom: 0.75rem; width:fit-content;">
                    <button type="button" id="civImperial" class="height-toggle-btn active" data-value="imperial" style="background:linear-gradient(135deg,#667eea 0%,#764ba2 100%); color:#fff; border:none; border-radius:6px; padding:0.5rem 1rem; font-size:0.9rem; font-weight:500; cursor:pointer; transition:all 0.2s ease;">Imperial (ft/in)</button>
                    <button type="button" id="civMetric" class="height-toggle-btn" data-value="metric" style="background:transparent; color:#a0aec0; border:none; border-radius:6px; padding:0.5rem 1rem; font-size:0.9rem; font-weight:500; cursor:pointer; transition:all 0.2s ease;">Metric (cm)</button>
                  </div>
                  <div class="civ-height-imperial" style="display:flex;gap:0.75rem; align-items:center;">
                    <input id="civHeightFoot" type="number" min="0" placeholder="ft" class="heroui-input civ-input" style="width:80px; height:44px;">
                    <input id="civHeightInches" type="number" min="0" max="11" placeholder="in" class="heroui-input civ-input" style="width:80px; height:44px;">
                  </div>
                  <div class="civ-height-metric" style="display:none;">
                    <input id="civHeightCm" type="number" min="0" placeholder="cm" class="heroui-input civ-input" style="width:160px; height:44px;">
                  </div>
                </div>
                
                <!-- Weight Section -->
                <div style="margin-bottom: 1.5rem;">
                  <label style="color:#e0e7ff; font-weight:500; display:block; margin-bottom:0.5rem;">Weight</label>
                  <div style="display: flex; background:#1e2028; border:1.5px solid #35385a; border-radius:8px; padding:0.25rem; margin-bottom: 0.75rem; width:fit-content;">
                    <button type="button" id="civImperialWeight" class="weight-toggle-btn active" data-value="imperial" style="background:linear-gradient(135deg,#667eea 0%,#764ba2 100%); color:#fff; border:none; border-radius:6px; padding:0.5rem 1rem; font-size:0.9rem; font-weight:500; cursor:pointer; transition:all 0.2s ease;">lbs</button>
                    <button type="button" id="civMetricWeight" class="weight-toggle-btn" data-value="metric" style="background:transparent; color:#a0aec0; border:none; border-radius:6px; padding:0.5rem 1rem; font-size:0.9rem; font-weight:500; cursor:pointer; transition:all 0.2s ease;">kg</button>
                  </div>
                  <div class="civ-weight-imperial">
                    <input id="civWeightLbs" type="number" min="0" placeholder="lbs" class="heroui-input civ-input" style="width:160px; height:44px;">
                  </div>
                  <div class="civ-weight-metric" style="display:none;">
                    <input id="civWeightKg" type="number" min="0" placeholder="kg" class="heroui-input civ-input" style="width:160px; height:44px;">
                  </div>
                </div>
                <!-- Checkboxes Row -->
                <div style="display: flex; gap: 2rem; align-items: center; margin-bottom: 1.5rem;">
                  <label class="heroui-checkbox-label" style="display:flex;align-items:center;gap:0.5rem;font-size:1em; cursor:pointer; color:#e0e7ff;">
                    <div class="heroui-checkbox" id="civOrganDonor" data-checked="false" style="width:20px;height:20px;border:2px solid #35385a;border-radius:4px;background:#1e2028;position:relative;transition:all 0.2s ease;display:flex;align-items:center;justify-content:center;flex-shrink:0;box-sizing:border-box;">
                      <i class="fa fa-check" style="color:#fff;font-size:0.75rem;display:none;line-height:1;"></i>
                    </div>
                    Organ Donor?
                  </label>
                  <label class="heroui-checkbox-label" style="display:flex;align-items:center;gap:0.5rem;font-size:1em; cursor:pointer; color:#e0e7ff;">
                    <div class="heroui-checkbox" id="civVeteran" data-checked="false" style="width:20px;height:20px;border:2px solid #35385a;border-radius:4px;background:#1e2028;position:relative;transition:all 0.2s ease;display:flex;align-items:center;justify-content:center;flex-shrink:0;box-sizing:border-box;">
                      <i class="fa fa-check" style="color:#fff;font-size:0.75rem;display:none;line-height:1;"></i>
                    </div>
                    Veteran?
                  </label>
                  <label class="heroui-checkbox-label" style="display:flex;align-items:center;gap:0.5rem;font-size:1em; cursor:pointer; color:#e0e7ff;">
                    <div class="heroui-checkbox" id="civParole" data-checked="false" style="width:20px;height:20px;border:2px solid #35385a;border-radius:4px;background:#1e2028;position:relative;transition:all 0.2s ease;display:flex;align-items:center;justify-content:center;flex-shrink:0;box-sizing:border-box;">
                      <i class="fa fa-check" style="color:#fff;font-size:0.75rem;display:none;line-height:1;"></i>
                    </div>
                    On Parole?
                  </label>
                  <label class="heroui-checkbox-label" style="display:flex;align-items:center;gap:0.5rem;font-size:1em; cursor:pointer; color:#e0e7ff;">
                    <div class="heroui-checkbox" id="civProbation" data-checked="false" style="width:20px;height:20px;border:2px solid #35385a;border-radius:4px;background:#1e2028;position:relative;transition:all 0.2s ease;display:flex;align-items:center;justify-content:center;flex-shrink:0;box-sizing:border-box;">
                      <i class="fa fa-check" style="color:#fff;font-size:0.75rem;display:none;line-height:1;"></i>
                    </div>
                    On Probation?
                  </label>
                </div>
                <div style="flex:1 1 100px; min-width:80px; margin-bottom:1rem;">
                  <label for="civEyeColor" style="color:#e0e7ff; font-weight:500;">Eye Color</label>
                  <input id="civEyeColor" name="eyeColor" type="text" class="heroui-input civ-input" style="width:100%; margin-top:0.2rem;" placeholder="Eye Color" />
                </div>
                <div style="flex:1 1 100px; min-width:80px; margin-bottom:1rem;">
                  <label for="civHairColor" style="color:#e0e7ff; font-weight:500;">Hair Color</label>
                  <input id="civHairColor" name="hairColor" type="text" class="heroui-input civ-input" style="width:100%; margin-top:0.2rem;" placeholder="Hair Color (optional)" />
                </div>
              </div>
              <div style="display:flex; gap:0.75rem; margin-top:1.5rem; justify-content:flex-end;">
                <button class="btn btn-danger" id="civDetailsDeleteBtn" style="background:#f56565; color:#fff; border:none; border-radius:8px; padding:0.6rem 1.2rem; font-weight:500;">Delete</button>
                <button class="btn btn-primary" id="civDetailsEditBtn" style="background:linear-gradient(135deg,#667eea 0%,#764ba2 100%); color:#fff; border:none; border-radius:8px; padding:0.6rem 1.2rem; font-weight:500;">Update Civilian</button>
                <button class="btn btn-secondary" id="civDetailsModalClose2" type="button" style="background:#35385a; color:#fff; border:none; border-radius:8px; padding:0.6rem 1.2rem; font-weight:500;">Close</button>
              </div>
            </div>
          </div>
        </form>
      </div>
      <div class="heroui-tab-content" id="civTabContent-vehicles" style="display:none;">
        <!-- Manage Vehicles Content -->
        <div style="margin-bottom:1.5rem;">
          <div style="font-size:1.2rem; font-weight:600; color:#f7fafc; margin-bottom:1rem;">
            <i class="fa fa-car" style="color:#667eea; margin-right:0.5rem;"></i>
            Manage Vehicles
          </div>
          <div style="margin-bottom:1rem;">
            <label style="color:#e0e7ff; font-weight:500; display:block; margin-bottom:0.5rem;">Search Vehicles:</label>
            <input id="manage-vehicle-search" type="search" class="heroui-input" style="width:100%; height:44px; background:#1e2028; color:#f7fafc; border:1.5px solid #35385a; border-radius:8px; font-size:1rem; font-weight:500; padding-left:1rem; padding-right:1rem;" placeholder="Search vehicles by plate, make, or model">
          </div>
        </div>
        
        <!-- Loading State -->
        <div id="manage-vehicles-loading" style="display:flex; justify-content:center; align-items:center; padding:3rem;">
          <div style="width:40px; height:40px; border:4px solid #35385a; border-top:4px solid #667eea; border-radius:50%; animation:spin 1s linear infinite;"></div>
        </div>
        
        <!-- Vehicles Grid -->
        <div id="manage-vehicles-thumbnail" class="cards-grid" style="display:none;">
          <!-- Dynamic vehicles will be loaded here -->
        </div>
        
        <!-- Error States -->
        <div id="issue-loading-vehicles-alert" style="display:none;">
          <p style="text-align:center; color:#f56565; font-style:italic; font-size:1rem;">
            ⚠️ Issue loading vehicles, try refreshing the page...
          </p>
        </div>
        <div id="manage-no-vehicles-message" style="display:none;">
          <p style="text-align:center; color:#a0aec0; font-style:italic; font-size:1rem;">
            No vehicles found, try adding one...
          </p>
        </div>
        
        <!-- Pagination -->
        <div class="pagination-container">
          <ul class="pagination">
            <li><a id="manage-prev-veh-page-btn">
                <i class="fa fa-chevron-left"></i> Previous
              </a></li>
            <li><a id="manage-next-veh-page-btn">
                Next <i class="fa fa-chevron-right"></i>
              </a></li>
          </ul>
        </div>
      </div>
      <div class="heroui-tab-content" id="civTabContent-firearms" style="display:none;">
        <!-- Manage Firearms Content -->
        <div style="margin-bottom:1.5rem;">
          <div style="font-size:1.2rem; font-weight:600; color:#f7fafc; margin-bottom:1rem;">
            <i class="fa fa-crosshairs" style="color:#667eea; margin-right:0.5rem;"></i>
            Manage Firearms
          </div>
          <div style="margin-bottom:1rem;">
            <label style="color:#e0e7ff; font-weight:500; display:block; margin-bottom:0.5rem;">Search Firearms:</label>
            <input id="manage-firearm-search" type="search" class="heroui-input" style="width:100%; height:44px; background:#1e2028; color:#f7fafc; border:1.5px solid #35385a; border-radius:8px; font-size:1rem; font-weight:500; padding-left:1rem; padding-right:1rem;" placeholder="Search firearms by name, type, or serial number">
          </div>
        </div>
        
        <!-- Loading State -->
        <div id="manage-firearms-loading" style="display:flex; justify-content:center; align-items:center; padding:3rem;">
          <div style="width:40px; height:40px; border:4px solid #35385a; border-top:4px solid #667eea; border-radius:50%; animation:spin 1s linear infinite;"></div>
        </div>
        
        <!-- Firearms Grid -->
        <div id="manage-firearms-thumbnail" class="cards-grid" style="display:none;">
          <!-- Dynamic firearms will be loaded here -->
        </div>
        
        <!-- Error States -->
        <div id="issue-loading-firearms-alert" style="display:none;">
          <p style="text-align:center; color:#f56565; font-style:italic; font-size:1rem;">
            ⚠️ Issue loading firearms, try refreshing the page...
          </p>
        </div>
        <div id="manage-no-firearms-message" style="display:none;">
          <p style="text-align:center; color:#a0aec0; font-style:italic; font-size:1rem;">
            No firearms found, try adding one...
          </p>
        </div>
        
        <!-- Pagination -->
        <div class="pagination-container">
          <ul class="pagination">
            <li><a id="manage-prev-firearm-page-btn">
                <i class="fa fa-chevron-left"></i> Previous
              </a></li>
            <li><a id="manage-next-firearm-page-btn">
                Next <i class="fa fa-chevron-right"></i>
              </a></li>
          </ul>
        </div>
      </div>
      <div class="heroui-tab-content" id="civTabContent-licenses" style="display:none;">
        <div style="padding:2rem;">
          <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:1.5rem;">
            <h3 style="color:#f7fafc; font-size:1.5rem; font-weight:700; margin:0;">Licenses</h3>
            <button onclick="openNewLicenseModal()" style="background:linear-gradient(135deg,#667eea 0%,#764ba2 100%); color:#fff; border:none; border-radius:8px; padding:0.75rem 1.5rem; font-weight:600; cursor:pointer; display:flex; align-items:center; gap:0.5rem;">
              <i class="fa fa-plus"></i>
              Add License
            </button>
          </div>
          
          <div style="margin-bottom:1rem;">
            <input type="search" id="manage-license-search" placeholder="Search licenses..." style="width:100%; height:44px; background:#23263a; color:#f7fafc; border:1.5px solid #35385a; border-radius:8px; font-size:1rem; font-weight:500; padding-left:1rem; padding-right:1rem; box-sizing:border-box;">
          </div>
          
          <div id="manage-licenses-loading" style="display:none; justify-content:center; align-items:center; padding:2rem;">
            <div style="display:flex; gap:0.5rem;">
              <div style="width:12px; height:12px; background:#667eea; border-radius:50%; animation:bounce 1.4s ease-in-out infinite both;"></div>
              <div style="width:12px; height:12px; background:#667eea; border-radius:50%; animation:bounce 1.4s ease-in-out infinite both 0.16s;"></div>
              <div style="width:12px; height:12px; background:#667eea; border-radius:50%; animation:bounce 1.4s ease-in-out infinite both 0.32s;"></div>
            </div>
          </div>
          
          <div id="manage-licenses-thumbnail" style="display:grid; grid-template-columns:repeat(auto-fill, minmax(280px, 1fr)); gap:1.5rem; margin-bottom:2rem;">
          </div>
          
          <div id="manage-no-licenses-message" style="display:none; text-align:center; padding:3rem; color:#a0aec0; font-style:italic;">
            <p style="font-size:1.1rem; margin:0;">No licenses found. Try adding one to get started.</p>
          </div>
          
          <div id="issue-loading-licenses-alert" style="display:none; text-align:center; padding:2rem; color:#f56565;">
            <p style="font-style:italic; font-size:1rem; margin:0;">⚠️ Issue loading licenses, try refreshing the page...</p>
          </div>
          
          <div style="display:flex; justify-content:center; gap:1rem; margin-top:2rem;">
            <button id="manage-prev-license-page-btn" onclick="getPrevLicensePage()" style="background:#2d3748; color:#a0aec0; border:none; border-radius:8px; padding:0.75rem 1.5rem; font-weight:500; cursor:pointer; display:flex; align-items:center; gap:0.5rem;">
              <i class="fa fa-chevron-left"></i>
              Previous
            </button>
            <button id="manage-next-license-page-btn" onclick="getNextLicensePage()" style="background:#2d3748; color:#a0aec0; border:none; border-radius:8px; padding:0.75rem 1.5rem; font-weight:500; cursor:pointer; display:flex; align-items:center; gap:0.5rem;">
              Next
              <i class="fa fa-chevron-right"></i>
            </button>
          </div>
        </div>
      </div>
      <div class="heroui-tab-content" id="civTabContent-records" style="display:none;">
        <!-- Records Content -->
        <div id="civRecordsTabCriminal" class="civ-records-tab-content" style="display: block;">
          <div id="civCriminalHistory" class="mt-4"></div>
          <div id="civArrestReports" class="mt-4"></div>
        </div>
      </div>
    </div>
  </div>
  <style>
    .civ-input {
      height: 44px !important;
      background: #23263a !important;
      color: #f7fafc !important;
      border: 1.5px solid #35385a !important;
      border-radius: 8px !important;
      font-size: 1rem !important;
      font-weight: 500;
      box-shadow: none !important;
      transition: border 0.2s, box-shadow 0.2s;
      padding-left: 1rem !important;
      padding-right: 1rem !important;
    }
    .civ-input:focus {
      border-color: #667eea !important;
      outline: none !important;
      box-shadow: 0 0 0 2px rgba(102,126,234,0.15) !important;
    }
         .civ-input::placeholder {
       color: #a0aec0 !important;
       opacity: 1 !important;
       font-weight: 400;
     }
     /* Vehicle modal styles */
     .veh-input {
       height: 44px !important;
       background: #1e2028 !important;
       color: #f7fafc !important;
       border: 1.5px solid #35385a !important;
       border-radius: 8px !important;
       font-size: 1rem !important;
       font-weight: 500;
       box-shadow: none !important;
       transition: border 0.2s, box-shadow 0.2s;
       padding-left: 1rem !important;
       padding-right: 1rem !important;
     }
     .veh-input:focus {
       border-color: #667eea !important;
       outline: none !important;
       box-shadow: 0 0 0 2px rgba(102,126,234,0.15) !important;
     }
     .veh-input::placeholder {
       color: #a0aec0 !important;
       opacity: 1 !important;
       font-weight: 400;
     }
     /* Firearm modal styles */
     .firearm-input {
       height: 44px !important;
       background: #1e2028 !important;
       color: #f7fafc !important;
       border: 1.5px solid #35385a !important;
       border-radius: 8px !important;
       font-size: 1rem !important;
       font-weight: 500;
       box-shadow: none !important;
       transition: border 0.2s, box-shadow 0.2s;
       padding-left: 1rem !important;
       padding-right: 1rem !important;
     }
     .firearm-input:focus {
       border-color: #667eea !important;
       outline: none !important;
       box-shadow: 0 0 0 2px rgba(102,126,234,0.15) !important;
     }
     .firearm-input::placeholder {
       color: #a0aec0 !important;
       opacity: 1 !important;
       font-weight: 400;
     }
     /* License modal styles */
     .license-input {
       height: 44px !important;
       background: #1e2028 !important;
       color: #f7fafc !important;
       border: 1.5px solid #35385a !important;
       border-radius: 8px !important;
       font-size: 1rem !important;
       font-weight: 500;
       box-shadow: none !important;
       transition: border 0.2s, box-shadow 0.2s;
       padding-left: 1rem !important;
       padding-right: 1rem !important;
     }
     .license-input:focus {
       border-color: #667eea !important;
       outline: none !important;
       box-shadow: 0 0 0 2px rgba(102,126,234,0.15) !important;
     }
     .license-input::placeholder {
       color: #a0aec0 !important;
       opacity: 1 !important;
       font-weight: 400;
     }
     textarea.license-input {
       height: auto !important;
       min-height: 80px !important;
       padding-top: 1rem !important;
       padding-bottom: 1rem !important;
       resize: vertical;
     }
     /* 911 Call modal styles */
     .heroui-input {
       height: 44px !important;
       background: #1e2028 !important;
       color: #f7fafc !important;
       border: 1.5px solid #35385a !important;
       border-radius: 8px !important;
       font-size: 1rem !important;
       font-weight: 500;
       box-shadow: none !important;
       transition: border 0.2s, box-shadow 0.2s;
       padding-left: 1rem !important;
       padding-right: 1rem !important;
     }
     .heroui-input:focus {
       border-color: #667eea !important;
       outline: none !important;
       box-shadow: 0 0 0 2px rgba(102,126,234,0.15) !important;
     }
     .heroui-input::placeholder {
       color: #a0aec0 !important;
       opacity: 1 !important;
       font-weight: 400;
     }
     textarea.heroui-input {
       height: auto !important;
       min-height: 80px !important;
       padding-top: 1rem !important;
       padding-bottom: 1rem !important;
       resize: vertical;
     }
    /* Profile pic hover animation */
    #civAvatarUpload {
      transition: box-shadow 0.25s, border 0.25s;
    }
    #civAvatarUpload:hover {
      box-shadow: 0 0 0 4px #764ba2, 0 2px 8px rgba(102,126,234,0.10);
      border: 2.5px solid #764ba2;
    }
    /* Modal scroll and background lock */
    #civDetailsModal .heroui-modal-content {
      background: #23263a;
      border-radius: 16px;
      max-width: 700px;
      width: 98%;
      margin: auto;
      box-shadow: 0 8px 32px rgba(0,0,0,0.25);
      padding: 2.5rem 2rem 2rem 2rem;
      position: relative;
      max-height: 90vh;
      overflow-y: auto;
    }
    
    /* Tab content display */
    .heroui-tab-content {
      display: none !important;
    }
    
    /* Override for explicitly set display block */
    .heroui-tab-content[style*="display: block"] {
      display: block !important;
    }
    
    /* Tab styling */
    .heroui-tab.active {
      color: #fff !important;
      border-bottom: 2px solid #667eea !important;
    }
    
    .heroui-tab:not(.active) {
      color: #a0aec0 !important;
    }
    
    body.modal-open {
      overflow: hidden !important;
    }
    @media (max-width: 768px) {
      .mobile-header {
        display: flex !important;
      }
      .mobile-toggle {
        position: static !important;
        margin-top: 0 !important;
        margin-bottom: 0 !important;
        z-index: 1103;
      }
      .container-fluid {
        margin-top: 56px !important;
      }
      
      /* Mobile modal improvements */
      .heroui-modal {
        align-items: flex-start !important;
        padding: 1rem;
      }
      
      .heroui-modal-content {
        max-height: calc(100vh - 2rem) !important;
        margin: 0 !important;
        width: 100% !important;
        border-radius: 12px !important;
        padding: 1.5rem 1rem 1rem 1rem !important;
      }
      
      /* Ensure form elements are properly sized on mobile */
      .firearm-input {
        font-size: 16px !important; /* Prevents zoom on iOS */
      }
      
      /* Improve button spacing on mobile */
      .heroui-tabs {
        gap: 0.5rem !important;
      }
      
      .heroui-tab {
        font-size: 1rem !important;
        padding: 0.4rem 0.8rem !important;
      }
    }
    @media (min-width: 769px) {
      .mobile-header {
        display: none !important;
      }
      .mobile-toggle {
        display: none !important;
      }
    }
  </style>
  <script>
    // Tab switching logic
    document.addEventListener('DOMContentLoaded', function() {
      const tabs = document.querySelectorAll('.heroui-tab');
      const tabContents = document.querySelectorAll('.heroui-tab-content');
      tabs.forEach(tab => {
        tab.addEventListener('click', function() {
          // Get the modal this tab belongs to
          const modal = tab.closest('.heroui-modal');
          if (!modal) return;
          
          // Remove active from all tabs in this modal
          modal.querySelectorAll('.heroui-tab').forEach(t => {
            t.classList.remove('active');
            t.style.color = '#a0aec0';
          });
          tab.classList.add('active');
          tab.style.color = '#fff';
          
          // Hide all tab contents in this modal
          modal.querySelectorAll('.heroui-tab-content').forEach(tc => tc.style.display = 'none');
          
          // Show the selected tab content
          const tabId = tab.getAttribute('data-tab');
          const targetContent = modal.querySelector('#civTabContent-' + tabId) || 
                               modal.querySelector('#vehTabContent-' + tabId) || 
                               modal.querySelector('#firearmTabContent-' + tabId) ||
                               modal.querySelector('#licenseTabContent-' + tabId) ||
                               modal.querySelector('#accountTabContent-' + tabId);
          if (targetContent) {
            targetContent.style.display = 'block';
            
            // Load content for specific tabs
            if (tabId === 'vehicles') {
              setTimeout(() => {
                getLinkedVehicles(0);
                // Attach search event listener after vehicles are loaded
                const searchInput = document.getElementById('manage-vehicle-search');
                if (searchInput) {
                  searchInput.addEventListener('input', function() {
                    const query = this.value.toLowerCase().trim();
                    const civilianId = document.getElementById('civIdHidden').value;
                    if (query === '') {
                      if (allLinkedVehicles.length > 0) {
                        renderLinkedVehicles(allLinkedVehicles, civilianId);
                        document.getElementById('manage-vehicles-thumbnail').style.display = 'grid';
                        document.getElementById('manage-no-vehicles-message').style.display = 'none';
                      } else {
                        document.getElementById('manage-vehicles-thumbnail').style.display = 'none';
                        document.getElementById('manage-no-vehicles-message').style.display = 'block';
                        document.getElementById('manage-no-vehicles-message').innerHTML = `<p style="text-align:center; color:#a0aec0; font-style:italic; font-size:1rem;">No vehicles found, try adding one...</p>`;
                      }
                      return;
                    }
                    const filteredVehicles = allLinkedVehicles.filter(vehicle => {
                      const vehicleData = vehicle.vehicle || vehicle;
                      const plate = vehicleData.plate || '';
                      const make = vehicleData.make || '';
                      const model = vehicleData.model || '';
                      const vehicleName = `${make} ${model}`.trim();
                      const matchesPlate = plate.toLowerCase().includes(query);
                      const matchesName = vehicleName.toLowerCase().includes(query);
                      const matches = matchesPlate || matchesName;
                      return matches;
                    });
                    if (filteredVehicles.length > 0) {
                      renderLinkedVehicles(filteredVehicles, civilianId);
                      document.getElementById('manage-vehicles-thumbnail').style.display = 'grid';
                      document.getElementById('manage-no-vehicles-message').style.display = 'none';
                    } else {
                      document.getElementById('manage-vehicles-thumbnail').style.display = 'none';
                      document.getElementById('manage-no-vehicles-message').style.display = 'block';
                      document.getElementById('manage-no-vehicles-message').innerHTML = `<p style=\"text-align:center; color:#a0aec0; font-style:italic; font-size:1rem;\">No vehicles found with plate \"${query}\"</p>`;
                    }
                  });
                }
              }, 100);
            }
            if (tabId === 'firearms') {
              setTimeout(() => {
                setupManageFirearmsTab();
                getLinkedFirearms(0);
              }, 100);
            }
            if (tabId === 'licenses') {
              setTimeout(() => {
                setupManageLicensesTab();
                getLinkedLicenses(1);
                // Attach search event listener after licenses are loaded
                const searchInput = document.getElementById('manage-license-search');
                if (searchInput) {
                  searchInput.addEventListener('input', function() {
                    const query = this.value.toLowerCase().trim();
                    const civilianId = document.getElementById('civIdHidden').value;
                    if (query === '') {
                      if (allLinkedLicenses.length > 0) {
                        renderLinkedLicenses(allLinkedLicenses, civilianId);
                        document.getElementById('manage-licenses-thumbnail').style.display = 'grid';
                        document.getElementById('manage-no-licenses-message').style.display = 'none';
                      } else {
                        document.getElementById('manage-licenses-thumbnail').style.display = 'none';
                        document.getElementById('manage-no-licenses-message').style.display = 'block';
                        document.getElementById('manage-no-licenses-message').innerHTML = `<p style="text-align:center; color:#a0aec0; font-style:italic; font-size:1rem;">No licenses found, try adding one...</p>`;
                      }
                      return;
                    }
                    const filteredLicenses = allLinkedLicenses.filter(license => {
                      const licenseData = license.license || license;
                      const type = licenseData.licenseType || '';
                      const status = licenseData.status || '';
                      const notes = licenseData.additionalNotes || '';
                      return (
                        type.toLowerCase().includes(query) ||
                        status.toLowerCase().includes(query) ||
                        notes.toLowerCase().includes(query)
                      );
                    });
                    if (filteredLicenses.length > 0) {
                      renderLinkedLicenses(filteredLicenses, civilianId);
                      document.getElementById('manage-licenses-thumbnail').style.display = 'grid';
                      document.getElementById('manage-no-licenses-message').style.display = 'none';
                    } else {
                      document.getElementById('manage-licenses-thumbnail').style.display = 'none';
                      document.getElementById('manage-no-licenses-message').style.display = 'block';
                      document.getElementById('manage-no-licenses-message').innerHTML = `<p style="text-align:center; color:#a0aec0; font-style:italic; font-size:1rem;">No licenses found with "${query}"</p>`;
                    }
                  });
                }
              }, 100);
            }
          }
        });
      });
      // Avatar upload logic
      var avatar = document.getElementById('civAvatarUpload');
      var fileInput = document.getElementById('civImageInput');
      if (avatar && fileInput) {
        avatar.addEventListener('click', function() {
          fileInput.click();
        });
      }
    });
    // All modal functions are now handled by modern-dashboard.js

    document.addEventListener('DOMContentLoaded', function() {
      // Firearm modal close buttons - these will be handled by modern-dashboard.js
      // The functions are defined in modern-dashboard.js and will be available globally

      // All firearm modal functionality is now handled by modern-dashboard.js
    });
  </script>

  <!-- Global variables -->
  <script type="text/javascript">
    var dbUser = <%- JSON.stringify(user) %>;
    var API_URL = "https://police-cad-app-api-bc6d659b60b3.herokuapp.com";
    
    // Fetch and display community name
    document.addEventListener('DOMContentLoaded', function() {
      if (dbUser && dbUser.user && dbUser.user.lastAccessedCommunity && dbUser.user.lastAccessedCommunity.communityID) {
        const communityId = dbUser.user.lastAccessedCommunity.communityID;
        $.ajax({
          url: `${API_URL}/api/v1/community/${communityId}`,
          type: "GET",
          success: function(commData) {
            if (commData && commData.community && commData.community.name) {
              $("#community-name").text(commData.community.name);
              $("#mobile-community-name").text(commData.community.name);
            } else {
              $("#community-name").text("Unknown Community");
              $("#mobile-community-name").text("Unknown Community");
            }
          },
          error: function(xhr) {
            console.error("Error fetching community details:", xhr.responseText);
            $("#community-name").text("Unknown Community");
            $("#mobile-community-name").text("Unknown Community");
          }
        });
      } else {
        $("#community-name").text("No Community");
        $("#mobile-community-name").text("No Community");
      }
    });
  </script>

  <!-- Scripts -->
  <script>if (typeof module === 'object') {window.module = module; module = undefined;}</script>
  <script src="/socket.io/socket.io.js"></script>
  <script src="https://code.jquery.com/jquery-3.5.1.js"></script>
  <script src="https://cdn.datatables.net/1.10.21/js/jquery.dataTables.min.js"></script>
  <script src="https://cdn.datatables.net/1.10.21/js/dataTables.bootstrap.min.js"></script>
  <script src="/static/js/bootstrap.min.js"></script>
  <script src="/static/js/jquery.easing.min.js"></script>
  <script src="/static/js/wow.js"></script>
  <script src="/static/js/popper.js"></script>
  <script src="/static/js/main.js"></script>
  <script src="/static/js/scripts.js"></script>
  <script src="/static/js/faker.js"></script>
  <script src="/static/js/moment.js"></script>
  <script src="/static/js/civ-dashboard.js"></script>
  <script src="/static/js/notifications.js"></script>
  <script src="/static/js/modern-dashboard.js"></script>
  <script src="/static/js/department-backgrounds.js"></script>
  <script src="/static/js/modern-departments.js"></script>
  <script src="/static/js/ads.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.0/jquery.cookie.min.js"></script>
  <script type="module" src="https://unpkg.com/ionicons@5.1.2/dist/ionicons/ionicons.esm.js"></script>
  <script nomodule="" src="https://unpkg.com/ionicons@5.1.2/dist/ionicons/ionicons.js"></script>
  
  <script>if (window.module) module = window.module;</script>
  <script type="text/javascript" src="//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>

  <!-- HeroUI Pro Sidebar JavaScript -->
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const sidebar = document.getElementById('herouiSidebar');
      const overlay = document.getElementById('sidebarOverlay');
      const mobileToggle = document.getElementById('mobileToggle');
      const mainContent = document.getElementById('mainContent');
      const collapseBtn = document.getElementById('sidebarCollapseBtn');
      const collapseIcon = document.getElementById('sidebarCollapseIcon');
      let isCollapsed = false;

      // Show collapse button only on desktop
      function updateCollapseBtnVisibility() {
        if (window.innerWidth > 768) {
          collapseBtn.style.display = 'flex';
        } else {
          collapseBtn.style.display = 'none';
        }
      }
      updateCollapseBtnVisibility();
      window.addEventListener('resize', updateCollapseBtnVisibility);

      // Collapse/expand sidebar
      collapseBtn.addEventListener('click', function() {
        isCollapsed = !isCollapsed;
        sidebar.classList.toggle('collapsed', isCollapsed);
        if (isCollapsed) {
          mainContent.classList.remove('with-sidebar');
          mainContent.classList.add('sidebar-collapsed');
          collapseIcon.classList.remove('fa-chevron-left');
          collapseIcon.classList.add('fa-chevron-right');
        } else {
          mainContent.classList.remove('sidebar-collapsed');
          mainContent.classList.add('with-sidebar');
          collapseIcon.classList.remove('fa-chevron-right');
          collapseIcon.classList.add('fa-chevron-left');
        }
      });

      // Mobile toggle
      mobileToggle.addEventListener('click', function() {
        sidebar.classList.toggle('open');
        overlay.classList.toggle('open');
      });

      // Overlay click to close
      overlay.addEventListener('click', function() {
        sidebar.classList.remove('open');
        overlay.classList.remove('open');
      });

      // Navigation toggles (for collapsible sections)
      document.querySelectorAll('.nav-toggle').forEach(function(toggle) {
        toggle.addEventListener('click', function() {
          const targetId = this.getAttribute('data-target');
          const submenu = document.getElementById(targetId);
          const isOpen = this.classList.contains('open');
          
          if (isOpen) {
            this.classList.remove('open');
            submenu.classList.add('collapsed');
          } else {
            this.classList.add('open');
            submenu.classList.remove('collapsed');
          }
        });
      });

      // Add sidebar class to main content on desktop
      function updateSidebarState() {
        if (window.innerWidth > 768) {
          if (isCollapsed) {
            mainContent.classList.add('sidebar-collapsed');
            mainContent.classList.remove('with-sidebar');
      } else {
            mainContent.classList.add('with-sidebar');
            mainContent.classList.remove('sidebar-collapsed');
          }
      } else {
          mainContent.classList.remove('with-sidebar', 'sidebar-collapsed');
        }
      }

      updateSidebarState();
      window.addEventListener('resize', updateSidebarState);
      
      // Initialize departments in sidebar
      if (typeof fetchAndRenderModernDepartments === 'function') {
        fetchAndRenderModernDepartments();
      }
    });
  </script>

  <!-- Modern Footer -->
  <footer id="lpc-footer" style="background: var(--dark-bg); color: var(--text-secondary); padding: 2rem 0 1.5rem 0; border-top: 1px solid var(--border-color); margin-top: 3rem; transition: margin-left 0.3s;">
    <div style="max-width: 1200px; margin: 0 auto; padding: 0 2rem;">
              <div style="display: flex; align-items: center; gap: 0.75rem;">
          <img src="/static/images/lpc-logo.svg?v=2" alt="LPC Logo" style="width: 32px; height: 32px; border-radius: 6px;">
          <span style="font-size: 1.2rem; font-weight: 600; color: #fff; letter-spacing: 0.02em;">Lines Police CAD</span>
        </div>
      <div style="margin-top: 1rem; font-size: 1rem; color: var(--text-secondary);">&copy; <%= new Date().getFullYear() %> Lines Police CAD. Making roleplay easier.</div>
      <div style="margin-top: 1.5rem; display: flex; gap: 1.2rem;">
        <a href="https://github.com/linesmerrill/police-cad" target="_blank" rel="noopener" style="color: var(--text-secondary); font-size: 1.3rem;"><i class="fab fa-github"></i></a>
        <a href="https://discord.gg/3ECFhqe" target="_blank" rel="noopener" style="color: var(--text-secondary); font-size: 1.3rem;"><i class="fab fa-discord"></i></a>
        <a href="mailto:support@linespolicecad.com" style="color: var(--text-secondary); font-size: 1.3rem;"><i class="fa fa-envelope"></i></a>
      </div>
      <div style="margin-top: 2.5rem; color: #44475a; font-size: 0.95rem;">Made with <span style="color: #f093fb;">&#10084;</span> by the LPC Team</div>
    </div>
  </footer>

  <!-- New Civilian Choice Modal -->
  <div id="newCivChoiceModal" class="modal fade" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog modal-md">
      <div class="modal-content" style="background: #23263a; border-radius: 16px; border: 1px solid #35385a;">
        <div class="modal-body" style="padding: 2rem;">
          <button class="btn btn-primary btn-md float-right" type="button" data-dismiss="modal" aria-hidden="true" style="background: none; border: none; color: #fff; font-size: 1.5rem; opacity: 0.7;">×</button>
          <h4 style="color: #f7fafc; margin-bottom: 1.5rem;">Create New Civilian</h4>
          <hr style="width: 88%; max-width: 100rem; border-color: #35385a;">
          <div class="text-align-center margin-bottom-1">
            <button onclick="openNewCivModal()" class="btn btn-primary btn-lg" data-dismiss="modal" aria-hidden="true" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border: none; padding: 1rem 2rem; border-radius: 12px; font-weight: 600;">
              <i class="fa fa-user-plus"></i> Manual Entry
            </button>
          </div>
          <div style="color: #a0aec0; margin-top: 1rem;">
            <span><i class="fa fa-user-plus"></i></span> <strong style="color: #f7fafc;">Manual:</strong> You specify all the details for your new civilian
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- New Civilian Modal -->
  <div id="newCivModal" class="modal fade" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog modal-lg">
      <div class="modal-content" style="background: #23263a; border-radius: 16px; border: 1px solid #35385a;">
        <div class="modal-body" style="padding: 2rem;">
          <form id="create-civ-form" class="form-horizontal" action="#" method="post">
            <fieldset>
              <!-- Form Header -->
              <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                <h4 style="color: #f7fafc; margin: 0;">Add a New Civilian</h4>
                <button class="btn btn-primary btn-md" type="button" data-dismiss="modal" aria-hidden="true" style="background: none; border: none; color: #fff; font-size: 1.5rem; opacity: 0.7;">×</button>
              </div>
              <hr style="width: 88%; max-width: 100rem; border-color: #35385a; margin-bottom: 2rem;">

              <h5 style="color: #f7fafc; margin-bottom: 1rem;"><i class="fa fa-user"></i> Basic Details</h5>

              <!-- Name -->
              <div class="form-group required" style="margin-bottom: 1.5rem;">
                <label class="col-md-4 control-label" for="civ-first-name" style="color: #e0e7ff; font-weight: 500;">Civilian Name*</label>
                <div class="col-md-8">
                  <input id="civ-first-name" name="civFirstName" type="text" placeholder="Enter full name" class="form-control input-md heroui-input" style="background: #1e2028; border: 1px solid #35385a; color: #f7fafc; border-radius: 8px; padding: 0.75rem;" required>
                </div>
              </div>

              <!-- Date of Birth -->
              <div class="form-group required" style="margin-bottom: 1.5rem;">
                <label class="col-md-4 control-label" for="birthday" style="color: #e0e7ff; font-weight: 500;">Date of Birth*</label>
                <div class="col-md-8">
                  <input id="birthday" name="birthday" type="date" max="2999-12-31" min="1900-01-01" class="form-control input-md heroui-input" style="background: #1e2028; border: 1px solid #35385a; color: #f7fafc; border-radius: 8px; padding: 0.75rem;" required>
                </div>
              </div>

              <!-- Address -->
              <div class="form-group" style="margin-bottom: 1.5rem;">
                <label class="col-md-4 control-label" for="address" style="color: #e0e7ff; font-weight: 500;">Address</label>
                <div class="col-md-8">
                  <input id="address" name="address" type="text" placeholder="Address (optional)" class="form-control input-md heroui-input" style="background: #1e2028; border: 1px solid #35385a; color: #f7fafc; border-radius: 8px; padding: 0.75rem;">
                </div>
              </div>

              <!-- Occupation -->
              <div class="form-group" style="margin-bottom: 1.5rem;">
                <label class="col-md-4 control-label" for="occupation" style="color: #e0e7ff; font-weight: 500;">Occupation</label>
                <div class="col-md-8">
                  <input id="occupation" name="occupation" type="text" placeholder="Job/occupation (optional)" class="form-control input-md heroui-input" style="background: #1e2028; border: 1px solid #35385a; color: #f7fafc; border-radius: 8px; padding: 0.75rem;">
                </div>
              </div>

              <hr style="width: 88%; max-width: 100rem; border-color: #35385a; margin: 2rem 0;">

              <h5 style="color: #f7fafc; margin-bottom: 1rem;"><i class="fa fa-user-cog"></i> Additional Details</h5>

              <!-- Gender -->
              <div class="form-group" style="margin-bottom: 1.5rem;">
                <label class="col-md-4 control-label" for="gender" style="color: #e0e7ff; font-weight: 500;">Gender</label>
                <div class="col-md-8">
                  <select id="gender" name="gender" class="form-control heroui-input" style="background: #1e2028; border: 1px solid #35385a; color: #f7fafc; border-radius: 8px; padding: 0.75rem;">
                    <option value="Other">Other</option>
                    <option value="Male">Male</option>
                    <option value="Female">Female</option>
                    <option value="Non-Binary">Non-Binary</option>
                  </select>
                </div>
              </div>

              <!-- Height -->
              <div class="form-group" style="margin-bottom: 1.5rem;">
                <label class="col-md-4 control-label" for="height" style="color: #e0e7ff; font-weight: 500;">Height</label>
                <div class="col-md-8">
                  <div style="display: flex; background:#1e2028; border:1.5px solid #35385a; border-radius:8px; padding:0.25rem; margin-bottom: 0.75rem; width:fit-content;">
                    <button type="button" class="height-toggle-btn active" data-value="imperial" style="background:linear-gradient(135deg,#667eea 0%,#764ba2 100%); color:#fff; border:none; border-radius:6px; padding:0.5rem 1rem; font-size:0.9rem; font-weight:500; cursor:pointer; transition:all 0.2s ease;">Imperial (ft/in)</button>
                    <button type="button" class="height-toggle-btn" data-value="metric" style="background:transparent; color:#a0aec0; border:none; border-radius:6px; padding:0.5rem 1rem; font-size:0.9rem; font-weight:500; cursor:pointer; transition:all 0.2s ease;">Metric (cm)</button>
                  </div>
                </div>
              </div>

              <!-- Height Imperial -->
              <div class="form-group civ-height-imperial" style="margin-bottom: 1.5rem;">
                <label class="col-md-4 control-label" for="height" style="color: #e0e7ff; font-weight: 500;">Height</label>
                <div class="col-md-8">
                  <div style="display: flex; gap: 1rem;">
                    <input id="foot" name="heightFoot" type="number" min="0" max="15" placeholder="ft" class="form-control input-md heroui-input" style="background: #1e2028; border: 1px solid #35385a; color: #f7fafc; border-radius: 8px; padding: 0.75rem; flex: 1;">
                    <input id="inches" name="heightInches" type="number" min="0" max="12" placeholder="in" class="form-control input-md heroui-input" style="background: #1e2028; border: 1px solid #35385a; color: #f7fafc; border-radius: 8px; padding: 0.75rem; flex: 1;">
                  </div>
                </div>
              </div>

              <!-- Height Metric -->
              <div class="form-group civ-height-metric" style="margin-bottom: 1.5rem; display: none;">
                <label class="col-md-4 control-label" for="height" style="color: #e0e7ff; font-weight: 500;">Height</label>
                <div class="col-md-8">
                  <input id="centimeters" name="heightCentimeters" min="0" max="457" type="number" placeholder="cm" class="form-control input-md heroui-input" style="background: #1e2028; border: 1px solid #35385a; color: #f7fafc; border-radius: 8px; padding: 0.75rem;">
                </div>
              </div>

              <!-- Weight -->
              <div class="form-group" style="margin-bottom: 1.5rem;">
                <label class="col-md-4 control-label" style="color: #e0e7ff; font-weight: 500;">Weight</label>
                <div class="col-md-8">
                  <div style="display: flex; background:#1e2028; border:1.5px solid #35385a; border-radius:8px; padding:0.25rem; margin-bottom: 0.75rem; width:fit-content;">
                    <button type="button" class="weight-toggle-btn active" data-value="imperial" style="background:linear-gradient(135deg,#667eea 0%,#764ba2 100%); color:#fff; border:none; border-radius:6px; padding:0.5rem 1rem; font-size:0.9rem; font-weight:500; cursor:pointer; transition:all 0.2s ease;">lbs</button>
                    <button type="button" class="weight-toggle-btn" data-value="metric" style="background:transparent; color:#a0aec0; border:none; border-radius:6px; padding:0.5rem 1rem; font-size:0.9rem; font-weight:500; cursor:pointer; transition:all 0.2s ease;">kg</button>
                  </div>
                </div>
              </div>

              <!-- Weight Imperial -->
              <div class="form-group civ-weight-imperial" style="margin-bottom: 1.5rem;">
                <label class="col-md-4 control-label" for="weight" style="color: #e0e7ff; font-weight: 500;">Weight</label>
                <div class="col-md-8">
                  <input id="pounds" name="weightImperial" min="0" max="1000" type="number" placeholder="lbs" class="form-control input-md heroui-input" style="background: #1e2028; border: 1px solid #35385a; color: #f7fafc; border-radius: 8px; padding: 0.75rem;">
                </div>
              </div>

              <!-- Weight Metric -->
              <div class="form-group civ-weight-metric" style="margin-bottom: 1.5rem; display: none;">
                <label class="col-md-4 control-label" for="weight" style="color: #e0e7ff; font-weight: 500;">Weight</label>
                <div class="col-md-8">
                  <input id="kilos" name="weightMetric" min="0" max="453" type="number" placeholder="kg" class="form-control input-md heroui-input" style="background: #1e2028; border: 1px solid #35385a; color: #f7fafc; border-radius: 8px; padding: 0.75rem;">
                </div>
              </div>

              <!-- Eye Color -->
              <div class="form-group" style="margin-bottom: 1.5rem;">
                <label class="col-md-4 control-label" for="eyeColor" style="color: #e0e7ff; font-weight: 500;">Eye Color</label>
                <div class="col-md-8">
                  <input id="eyeColor" name="eyeColor" type="text" placeholder="Eye color (optional)" class="form-control input-md heroui-input" style="background: #1e2028; border: 1px solid #35385a; color: #f7fafc; border-radius: 8px; padding: 0.75rem;">
                </div>
              </div>

              <!-- Hair Color -->
              <div class="form-group" style="margin-bottom: 1.5rem;">
                <label class="col-md-4 control-label" for="hairColor" style="color: #e0e7ff; font-weight: 500;">Hair Color</label>
                <div class="col-md-8">
                  <input id="hairColor" name="hairColor" type="text" placeholder="Hair color (optional)" class="form-control input-md heroui-input" style="background: #1e2028; border: 1px solid #35385a; color: #f7fafc; border-radius: 8px; padding: 0.75rem;">
                </div>
              </div>

              <!-- Checkboxes -->
              <div class="form-group" style="margin-bottom: 1.5rem;">
                <label class="col-md-4 control-label" style="color: #e0e7ff; font-weight: 500;">Additional Information</label>
                <div class="col-md-8">
                  <div style="display: flex; flex-direction: column; gap: 0.75rem;">
                    <label style="color: #a0aec0; margin: 0; display: flex; align-items: center;">
                      <input id="organDonor" type="checkbox" name="organDonor" style="margin-right: 0.75rem;"> Organ Donor
                    </label>
                    <label style="color: #a0aec0; margin: 0; display: flex; align-items: center;">
                      <input id="veteran" type="checkbox" name="veteran" style="margin-right: 0.75rem;"> Veteran
                    </label>
                    <label style="color: #a0aec0; margin: 0; display: flex; align-items: center;">
                      <input id="onParole" type="checkbox" name="onParole" style="margin-right: 0.75rem;"> On Parole
                    </label>
                    <label style="color: #a0aec0; margin: 0; display: flex; align-items: center;">
                      <input id="onProbation" type="checkbox" name="onProbation" style="margin-right: 0.75rem;"> On Probation
                    </label>
                  </div>
                </div>
              </div>

              <hr style="width: 88%; max-width: 100rem; border-color: #35385a; margin: 2rem 0;">

              <!-- Hidden inputs -->
              <input type="hidden" name="route" value="civ-dashboard">
              <input id="ageAmount" type="hidden" name="ageView" value="">
              <input id="newCivUserID" type="hidden" name="userID" value="<%= user._id %>">
              <input id="new-civ-activeCommunityID-new-civ" type="hidden" name="activeCommunityID" value="<%= user.user.lastAccessedCommunity?.communityID %>">

              <!-- Submit Button -->
              <div class="form-group" style="margin-top: 2rem;">
                <div style="display:flex; gap:0.75rem; margin-top:1.5rem; justify-content:flex-end;">
                  <button type="button" class="btn btn-secondary" id="newCivModalCancel" style="background:#35385a; color:#fff; border:none; border-radius:8px; padding:0.6rem 1.2rem; font-weight:500;">Cancel</button>
                  <button id="submitNewCiv" type="submit" name="submitNewCivForm" value="submit" class="btn btn-primary" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color:#fff; border:none; border-radius:8px; padding:0.6rem 1.2rem; font-weight:500;">Create Civilian</button>
                </div>
              </div>
            </fieldset>
          </form>
        </div>
      </div>
    </div>
  </div>

  <!-- HeroUI Vehicle Details Modal -->
  <div id="vehDetailsModal" class="heroui-modal" style="display:none; position:fixed; z-index:2000; left:0; top:0; width:100vw; height:100vh; background:rgba(30,32,44,0.65); align-items:center; justify-content:center;">
    <div class="heroui-modal-content" style="background:#23263a; border-radius:16px; max-width:700px; width:98%; margin:auto; box-shadow:0 8px 32px rgba(0,0,0,0.25); padding:2.5rem 2rem 2rem 2rem; position:relative; max-height:90vh; overflow-y:auto;">
      <button id="vehDetailsModalClose" aria-label="Close" style="position:absolute; top:1.2rem; right:1.2rem; background:none; border:none; color:#fff; font-size:1.5rem; cursor:pointer; opacity:0.7;"><i class="fa fa-times"></i></button>
      <!-- Tab Content -->
      <div class="heroui-tab-content" id="vehTabContent-edit" style="display: block;">
        <!-- Edit Vehicle Form -->
        <form id="editVehicleForm" autocomplete="off">
          <input type="hidden" id="vehIdHidden" />
          <div style="display:flex; gap:2rem; align-items:flex-start; flex-wrap:wrap;">
            <div style="flex:1 1 220px; min-width:220px;">
              <div id="vehImageUpload" style="width:90px; height:90px; border-radius:50%; background:linear-gradient(135deg,#667eea 0%,#764ba2 100%); display:flex; align-items:center; justify-content:center; font-size:2.5rem; color:#fff; margin-bottom:1.2rem; position:relative; cursor:pointer; transition:box-shadow 0.2s; box-shadow:0 2px 8px rgba(102,126,234,0.10); overflow:hidden;">
                <img id="vehImageImg" src="" alt="Vehicle" style="display:none; width:100%; height:100%; object-fit:cover; border-radius:50%; position:absolute; left:0; top:0;" />
                <i class="fa fa-car" id="vehImageIcon"></i>
                <span style="position:absolute; bottom:8px; right:8px; background:rgba(30,32,44,0.85); border-radius:50%; padding:7px; display:flex; align-items:center; justify-content:center; transition:background 0.2s;">
                  <i class="fa fa-camera" style="font-size:1.55rem; color:#f7fafc;"></i>
                </span>
                <input type="file" id="vehImageInput" accept="image/*" style="display:none;" />
              </div>
              <div style="font-size:1.1rem; color:#a0aec0; margin-bottom:0.5rem;">Vehicle Photo</div>
            </div>
            <div style="flex:2 1 320px; min-width:260px;">
              <div style="font-size:1.2rem; font-weight:600; color:#f7fafc; margin-bottom:0.7rem;">Vehicle Information</div>
              <div style="display:flex; gap:1.2rem; flex-wrap:wrap;">
                <div style="flex:1 1 140px; min-width:120px; margin-bottom:1rem;">
                  <label for="vehPlate" style="color:#e0e7ff; font-weight:500;">License Plate*</label>
                  <input id="vehPlate" name="plate" type="text" class="heroui-input veh-input" style="width:100%; margin-top:0.2rem; text-transform:uppercase;" required placeholder="ABC123" maxlength="8" />
                </div>
                <div style="flex:1 1 140px; min-width:120px; margin-bottom:1rem;">
                  <label for="vehPlateState" style="color:#e0e7ff; font-weight:500;">Plate State</label>
                  <input id="vehPlateState" name="licensePlateState" type="text" class="heroui-input veh-input" style="width:100%; margin-top:0.2rem;" placeholder="CA" maxlength="2" />
                </div>
                <div style="flex:1 1 140px; min-width:120px; margin-bottom:1rem;">
                  <label for="vehVin" style="color:#e0e7ff; font-weight:500;">VIN*</label>
                  <div style="display:flex; align-items:center; gap:0.5rem;">
                    <input id="vehVin" name="vin" type="text" class="heroui-input veh-input" style="width:100%; margin-top:0.2rem;" required placeholder="VIN" minlength="17" maxlength="17" />
                    <button type="button" id="generateVinBtn" class="btn btn-info" style="margin-left:0.5rem; padding:0.3rem 1rem; border-radius:8px; font-size:1rem;">Generate</button>
                  </div>
                </div>
              </div>
              <div style="display:flex; gap:1.2rem; flex-wrap:wrap;">
                <div style="flex:1 1 120px; min-width:100px; margin-bottom:1rem;">
                  <label for="vehType" style="color:#e0e7ff; font-weight:500;">Type*</label>
                  <input id="vehType" name="type" type="text" class="heroui-input veh-input" style="width:100%; margin-top:0.2rem;" required placeholder="Type (e.g. Sedan, Truck)" />
                </div>
                <div style="flex:1 1 120px; min-width:100px; margin-bottom:1rem;">
                  <label for="vehMake" style="color:#e0e7ff; font-weight:500;">Make</label>
                  <input id="vehMake" name="make" type="text" class="heroui-input veh-input" style="width:100%; margin-top:0.2rem;" placeholder="Make" />
                </div>
                <div style="flex:1 1 120px; min-width:100px; margin-bottom:1rem;">
                  <label for="vehModel" style="color:#e0e7ff; font-weight:500;">Model</label>
                  <input id="vehModel" name="model" type="text" class="heroui-input veh-input" style="width:100%; margin-top:0.2rem;" placeholder="Model" />
                </div>
                <div style="flex:1 1 80px; min-width:80px; margin-bottom:1rem;">
                  <label for="vehYear" style="color:#e0e7ff; font-weight:500;">Year</label>
                  <input id="vehYear" name="year" type="number" class="heroui-input veh-input" style="width:100%; margin-top:0.2rem;" placeholder="Year" min="1900" max="2030" />
                </div>
              </div>
              <div style="display:flex; gap:1.2rem; flex-wrap:wrap;">
                <div style="flex:1 1 120px; min-width:100px; margin-bottom:1rem;">
                  <label for="vehColor" style="color:#e0e7ff; font-weight:500;">Color</label>
                  <input id="vehColor" name="color" type="text" class="heroui-input veh-input" style="width:100%; margin-top:0.2rem;" placeholder="Color" />
                </div>
              </div>
              <div style="font-size:1.1rem; color:#a0aec0; margin-bottom:0.5rem; margin-top:1.2rem;">Registration & Insurance</div>
              <div style="display:flex; gap:1.2rem; flex-wrap:wrap;">
                <div style="flex:1 1 120px; min-width:100px; margin-bottom:1rem;">
                  <label for="vehValidRegistration" style="color:#e0e7ff; font-weight:500;">Valid Registration</label>
                  <select id="vehValidRegistration" name="validRegistration" class="heroui-input veh-input" style="width:100%; margin-top:0.2rem;">
                    <option value="true">Yes</option>
                    <option value="false">No</option>
                  </select>
                </div>
                <div style="flex:1 1 120px; min-width:100px; margin-bottom:1rem;">
                  <label for="vehValidInsurance" style="color:#e0e7ff; font-weight:500;">Valid Insurance</label>
                  <select id="vehValidInsurance" name="validInsurance" class="heroui-input veh-input" style="width:100%; margin-top:0.2rem;">
                    <option value="true">Yes</option>
                    <option value="false">No</option>
                  </select>
                </div>
                <div style="flex:1 1 120px; min-width:100px; margin-bottom:1rem;">
                  <label for="vehIsStolen" style="color:#e0e7ff; font-weight:500;">Stolen Status</label>
                  <select id="vehIsStolen" name="isStolen" class="heroui-input veh-input" style="width:100%; margin-top:0.2rem;">
                    <option value="false">No</option>
                    <option value="true">Yes</option>
                  </select>
                </div>
              </div>
              <div style="display:flex; gap:0.75rem; margin-top:1.5rem; justify-content:flex-end;">
                <button class="btn btn-danger" id="vehDetailsDeleteBtn" style="background:#f56565; color:#fff; border:none; border-radius:8px; padding:0.6rem 1.2rem; font-weight:500;">Delete</button>
                <button class="btn btn-primary" id="vehDetailsEditBtn" style="background:linear-gradient(135deg,#667eea 0%,#764ba2 100%); color:#fff; border:none; border-radius:8px; padding:0.6rem 1.2rem; font-weight:500;">Update Vehicle</button>
                <button class="btn btn-secondary" id="vehDetailsModalClose2" type="button" style="background:#35385a; color:#fff; border:none; border-radius:8px; padding:0.6rem 1.2rem; font-weight:500;">Close</button>
              </div>
            </div>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Add New Vehicle Modal -->
  <div id="newVehicleModal" class="heroui-modal" style="display:none; position:fixed; z-index:2000; left:0; top:0; width:100vw; height:100vh; background:rgba(30,32,44,0.65); align-items:center; justify-content:center;">
    <div class="heroui-modal-content" style="background:#23263a; border-radius:16px; max-width:700px; width:98%; margin:auto; box-shadow:0 8px 32px rgba(0,0,0,0.25); padding:2.5rem 2rem 2rem 2rem; position:relative; max-height:90vh; overflow-y:auto;">
      <button id="newVehicleModalClose" aria-label="Close" style="position:absolute; top:1.2rem; right:1.2rem; background:none; border:none; color:#fff; font-size:1.5rem; cursor:pointer; opacity:0.7;"><i class="fa fa-times"></i></button>
      <div style="font-size:1.5rem; font-weight:700; color:#f7fafc; margin-bottom:1.5rem;">Add New Vehicle</div>
      <form id="createVehicleForm" autocomplete="off">
        <div style="display:flex; gap:2rem; align-items:flex-start; flex-wrap:wrap;">
          <div style="flex:1 1 220px; min-width:220px;">
            <div id="newVehImageUpload" style="width:90px; height:90px; border-radius:50%; background:linear-gradient(135deg,#667eea 0%,#764ba2 100%); display:flex; align-items:center; justify-content:center; font-size:2.5rem; color:#fff; margin-bottom:1.2rem; position:relative; cursor:pointer; transition:box-shadow 0.2s; box-shadow:0 2px 8px rgba(102,126,234,0.10); overflow:hidden;">
              <img id="newVehImageImg" src="" alt="Vehicle" style="display:none; width:100%; height:100%; object-fit:cover; border-radius:50%; position:absolute; left:0; top:0;" />
              <i class="fa fa-car" id="newVehImageIcon"></i>
              <span style="position:absolute; bottom:8px; right:8px; background:rgba(30,32,44,0.85); border-radius:50%; padding:7px; display:flex; align-items:center; justify-content:center; transition:background 0.2s;">
                <i class="fa fa-camera" style="font-size:1.55rem; color:#f7fafc;"></i>
              </span>
              <input type="file" id="newVehImageInput" accept="image/*" style="display:none;" />
            </div>
            <div style="font-size:1.1rem; color:#a0aec0; margin-bottom:0.5rem;">Vehicle Photo</div>
          </div>
          <div style="flex:2 1 320px; min-width:260px;">
            <div style="font-size:1.2rem; font-weight:600; color:#f7fafc; margin-bottom:0.7rem;">Vehicle Information</div>
            <div style="display:flex; gap:1.2rem; flex-wrap:wrap;">
              <div style="flex:1 1 140px; min-width:120px; margin-bottom:1rem;">
                <label for="newVehPlate" style="color:#e0e7ff; font-weight:500;">License Plate*</label>
                <input id="newVehPlate" name="plate" type="text" class="heroui-input veh-input" style="width:100%; margin-top:0.2rem; text-transform:uppercase;" required placeholder="ABC123" maxlength="8" />
              </div>
              <div style="flex:1 1 140px; min-width:120px; margin-bottom:1rem;">
                <label for="newVehPlateState" style="color:#e0e7ff; font-weight:500;">Plate State</label>
                <input id="newVehPlateState" name="licensePlateState" type="text" class="heroui-input veh-input" style="width:100%; margin-top:0.2rem;" placeholder="CA" maxlength="2" />
              </div>
              <div style="flex:1 1 140px; min-width:120px; margin-bottom:1rem;">
                <label for="newVehVin" style="color:#e0e7ff; font-weight:500;">VIN*</label>
                <div style="display:flex; align-items:center; gap:0.5rem;">
                  <input id="newVehVin" name="vin" type="text" class="heroui-input veh-input" style="width:100%; margin-top:0.2rem;" required placeholder="VIN" minlength="17" maxlength="17" />
                  <button type="button" id="generateNewVinBtn" style="background:linear-gradient(135deg,#10b981 0%,#059669 100%); color:#fff; border:none; border-radius:8px; padding:0.5rem 1rem; font-size:0.9rem; font-weight:500; cursor:pointer; transition:all 0.2s ease; box-shadow:0 2px 8px rgba(16,185,129,0.15); display:flex; align-items:center; gap:0.5rem;"><i class="fa fa-magic"></i> Generate</button>
                </div>
              </div>
            </div>
            <div style="display:flex; gap:1.2rem; flex-wrap:wrap;">
              <div style="flex:1 1 120px; min-width:100px; margin-bottom:1rem;">
                <label for="newVehType" style="color:#e0e7ff; font-weight:500;">Type*</label>
                <input id="newVehType" name="type" type="text" class="heroui-input veh-input" style="width:100%; margin-top:0.2rem;" required placeholder="Type (e.g. Sedan, Truck)" />
              </div>
              <div style="flex:1 1 120px; min-width:100px; margin-bottom:1rem;">
                <label for="newVehMake" style="color:#e0e7ff; font-weight:500;">Make</label>
                <input id="newVehMake" name="make" type="text" class="heroui-input veh-input" style="width:100%; margin-top:0.2rem;" placeholder="Make" />
              </div>
              <div style="flex:1 1 120px; min-width:100px; margin-bottom:1rem;">
                <label for="newVehModel" style="color:#e0e7ff; font-weight:500;">Model</label>
                <input id="newVehModel" name="model" type="text" class="heroui-input veh-input" style="width:100%; margin-top:0.2rem;" placeholder="Model" />
              </div>
              <div style="flex:1 1 80px; min-width:80px; margin-bottom:1rem;">
                <label for="newVehYear" style="color:#e0e7ff; font-weight:500;">Year</label>
                <input id="newVehYear" name="year" type="number" class="heroui-input veh-input" style="width:100%; margin-top:0.2rem;" placeholder="Year" min="1900" max="2030" />
              </div>
            </div>
            <div style="display:flex; gap:1.2rem; flex-wrap:wrap;">
              <div style="flex:1 1 120px; min-width:100px; margin-bottom:1rem;">
                <label for="newVehColor" style="color:#e0e7ff; font-weight:500;">Color</label>
                <input id="newVehColor" name="color" type="text" class="heroui-input veh-input" style="width:100%; margin-top:0.2rem;" placeholder="Color" />
              </div>
            </div>
            <div style="font-size:1.1rem; color:#a0aec0; margin-bottom:0.5rem; margin-top:1.2rem;">Registration & Insurance</div>
            <div style="display:flex; gap:1.2rem; flex-wrap:wrap;">
              <div style="flex:1 1 120px; min-width:100px; margin-bottom:1rem;">
                <label for="newVehValidRegistration" style="color:#e0e7ff; font-weight:500;">Valid Registration</label>
                <select id="newVehValidRegistration" name="validRegistration" class="heroui-input veh-input" style="width:100%; margin-top:0.2rem;">
                  <option value="true">Yes</option>
                  <option value="false">No</option>
                </select>
              </div>
              <div style="flex:1 1 120px; min-width:100px; margin-bottom:1rem;">
                <label for="newVehValidInsurance" style="color:#e0e7ff; font-weight:500;">Valid Insurance</label>
                <select id="newVehValidInsurance" name="validInsurance" class="heroui-input veh-input" style="width:100%; margin-top:0.2rem;">
                  <option value="true">Yes</option>
                  <option value="false">No</option>
                </select>
              </div>
              <div style="flex:1 1 120px; min-width:100px; margin-bottom:1rem;">
                <label for="newVehIsStolen" style="color:#e0e7ff; font-weight:500;">Stolen Status</label>
                <select id="newVehIsStolen" name="isStolen" class="heroui-input veh-input" style="width:100%; margin-top:0.2rem;">
                  <option value="false">No</option>
                  <option value="true">Yes</option>
                </select>
              </div>
            </div>
            <div style="display:flex; gap:0.75rem; margin-top:1.5rem; justify-content:flex-end;">
              <button class="btn btn-secondary" id="newVehicleModalCancel" type="button" style="background:#35385a; color:#fff; border:none; border-radius:8px; padding:0.6rem 1.2rem; font-weight:500;">Cancel</button>
              <button class="btn btn-primary" id="createVehicleBtn" type="submit" style="background:linear-gradient(135deg,#667eea 0%,#764ba2 100%); color:#fff; border:none; border-radius:8px; padding:0.6rem 1.2rem; font-weight:500;">Create Vehicle</button>
            </div>
          </div>
        </div>
      </form>
    </div>
  </div>

  <!-- HeroUI Firearm Details Modal -->
  <div id="firearmDetailsModal" class="heroui-modal" style="display:none; position:fixed; z-index:2000; left:0; top:0; width:100vw; height:100vh; background:rgba(30,32,44,0.65); align-items:center; justify-content:center;">
    <div class="heroui-modal-content" style="background:#23263a; border-radius:16px; max-width:700px; width:98%; margin:auto; box-shadow:0 8px 32px rgba(0,0,0,0.25); padding:2.5rem 2rem 2rem 2rem; position:relative; max-height:90vh; overflow-y:auto; overflow-x:hidden;">
      <button id="firearmDetailsModalClose" aria-label="Close" style="position:absolute; top:1.2rem; right:1.2rem; background:none; border:none; color:#fff; font-size:1.5rem; cursor:pointer; opacity:0.7;"><i class="fa fa-times"></i></button>
      <!-- Tabs -->
      <div class="heroui-tabs" style="display:flex; gap:1.2rem; border-bottom:1.5px solid #35385a; margin-bottom:2rem;">
        <button class="heroui-tab active" data-tab="edit" style="background:none; border:none; color:#fff; font-size:1.1rem; font-weight:600; padding:0.5rem 1.2rem; border-radius:8px 8px 0 0; cursor:pointer;">Edit Firearm</button>
      </div>
      <!-- Tab Content -->
      <div class="heroui-tab-content" id="firearmTabContent-edit" style="display: block;">
        <!-- Edit Firearm Form -->
        <form id="editFirearmForm" autocomplete="off">
          <input type="hidden" id="firearmIdHidden" />
          <div style="display:flex; gap:2rem; align-items:flex-start; flex-wrap:wrap;">
            <div style="flex:1 1 220px; min-width:220px;">
              <div id="firearmImageUpload" style="width:90px; height:90px; border-radius:50%; background:linear-gradient(135deg,#667eea 0%,#764ba2 100%); display:flex; align-items:center; justify-content:center; font-size:2.5rem; color:#fff; margin-bottom:1.2rem; position:relative; cursor:pointer; transition:box-shadow 0.2s; box-shadow:0 2px 8px rgba(102,126,234,0.10); overflow:hidden;">
                <img id="firearmImageImg" src="" alt="Firearm" style="display:none; width:100%; height:100%; object-fit:cover; border-radius:50%; position:absolute; left:0; top:0;" />
                <i class="fa fa-crosshairs" id="firearmImageIcon"></i>
                <span style="position:absolute; bottom:8px; right:8px; background:rgba(30,32,44,0.85); border-radius:50%; padding:7px; display:flex; align-items:center; justify-content:center; transition:background 0.2s;">
                  <i class="fa fa-camera" style="font-size:1.55rem; color:#f7fafc;"></i>
                </span>
                <input type="file" id="firearmImageInput" accept="image/*" style="display:none;" />
              </div>
              <div style="font-size:1.1rem; color:#a0aec0; margin-bottom:0.5rem;">Firearm Photo</div>
            </div>
            <div style="flex:2 1 320px; min-width:260px;">
              <div style="font-size:1.2rem; font-weight:600; color:#f7fafc; margin-bottom:0.7rem;">Details about your Firearm</div>
              <div style="display:flex; gap:1.2rem; flex-wrap:wrap;">
                <div style="flex:1 1 140px; min-width:120px; margin-bottom:1rem;">
                  <label for="firearmSerial" style="color:#e0e7ff; font-weight:500;">Serial Number*</label>
                  <div style="display:flex; align-items:center; gap:0.5rem;">
                    <input id="firearmSerial" name="serialNumber" type="text" class="heroui-input firearm-input" style="width:100%; margin-top:0.2rem;" required placeholder="Serial Number" />
                    <button type="button" id="generateSerialBtn" style="background:linear-gradient(135deg,#10b981 0%,#059669 100%); color:#fff; border:none; border-radius:8px; padding:0.5rem 1rem; font-size:0.9rem; font-weight:500; cursor:pointer; transition:all 0.2s ease; box-shadow:0 2px 8px rgba(16,185,129,0.15); display:flex; align-items:center; gap:0.5rem;"><i class="fa fa-magic"></i> Generate</button>
                  </div>
                </div>
              </div>
              <div style="display:flex; gap:1.2rem; flex-wrap:wrap;">
                <div style="flex:1 1 140px; min-width:120px; margin-bottom:1rem;">
                  <label for="firearmName" style="color:#e0e7ff; font-weight:500;">Name*</label>
                  <input id="firearmName" name="name" type="text" class="heroui-input firearm-input" style="width:100%; margin-top:0.2rem;" required placeholder="Firearm Name" />
                </div>
              </div>
              <div style="display:flex; gap:1.2rem; flex-wrap:wrap;">
                <div style="flex:1 1 120px; min-width:100px; margin-bottom:1rem;">
                  <label for="firearmType" style="color:#e0e7ff; font-weight:500;">Type*</label>
                  <input id="firearmType" name="weaponType" type="text" class="heroui-input firearm-input" style="width:100%; margin-top:0.2rem;" required placeholder="Type (e.g. Pistol, Rifle)" />
                </div>
                <div style="flex:1 1 120px; min-width:100px; margin-bottom:1rem;">
                  <label for="firearmCaliber" style="color:#e0e7ff; font-weight:500;">Caliber</label>
                  <input id="firearmCaliber" name="caliber" type="text" class="heroui-input firearm-input" style="width:100%; margin-top:0.2rem;" placeholder="Caliber" />
                </div>
              </div>
              <div style="font-size:1.1rem; color:#a0aec0; margin-bottom:0.5rem; margin-top:1.2rem;">Status Information</div>
              <div style="display:flex; gap:1.2rem; flex-wrap:wrap;">
                <div style="flex:1 1 120px; min-width:100px; margin-bottom:1rem;">
                  <label for="firearmIsStolen" style="color:#e0e7ff; font-weight:500;">Stolen Status</label>
                  <select id="firearmIsStolen" name="isStolen" class="heroui-input firearm-input" style="width:100%; margin-top:0.2rem;">
                    <option value="false">No</option>
                    <option value="true">Yes</option>
                  </select>
                </div>
              </div>
              <div style="display:flex; gap:0.75rem; margin-top:1.5rem; justify-content:flex-end;">
                <button class="btn btn-danger" id="firearmDetailsDeleteBtn" style="background:#f56565; color:#fff; border:none; border-radius:8px; padding:0.6rem 1.2rem; font-weight:500;">Delete</button>
                <button class="btn btn-primary" id="firearmDetailsEditBtn" style="background:linear-gradient(135deg,#667eea 0%,#764ba2 100%); color:#fff; border:none; border-radius:8px; padding:0.6rem 1.2rem; font-weight:500;">Update Firearm</button>
                <button class="btn btn-secondary" id="firearmDetailsModalClose2" type="button" style="background:#35385a; color:#fff; border:none; border-radius:8px; padding:0.6rem 1.2rem; font-weight:500;">Close</button>
              </div>
            </div>
          </div>
        </form>
      </div>

    </div>
  </div>

  <!-- Add New Firearm Modal -->
  <div id="newFirearmModal" class="heroui-modal" style="display:none; position:fixed; z-index:2000; left:0; top:0; width:100vw; height:100vh; background:rgba(30,32,44,0.65); align-items:center; justify-content:center;">
    <div class="heroui-modal-content" style="background:#23263a; border-radius:16px; max-width:700px; width:98%; margin:auto; box-shadow:0 8px 32px rgba(0,0,0,0.25); padding:2.5rem 2rem 2rem 2rem; position:relative; max-height:90vh; overflow-y:auto;">
      <button id="newFirearmModalClose" aria-label="Close" style="position:absolute; top:1.2rem; right:1.2rem; background:none; border:none; color:#fff; font-size:1.5rem; cursor:pointer; opacity:0.7;"><i class="fa fa-times"></i></button>
      <div style="font-size:1.5rem; font-weight:700; color:#f7fafc; margin-bottom:1.5rem;">Add New Firearm</div>
      <form id="createFirearmForm" autocomplete="off">
        <div style="display:flex; gap:2rem; align-items:flex-start; flex-wrap:wrap;">
          <div style="flex:1 1 220px; min-width:220px;">
            <div id="newFirearmImageUpload" style="width:90px; height:90px; border-radius:50%; background:linear-gradient(135deg,#667eea 0%,#764ba2 100%); display:flex; align-items:center; justify-content:center; font-size:2.5rem; color:#fff; margin-bottom:1.2rem; position:relative; cursor:pointer; transition:box-shadow 0.2s; box-shadow:0 2px 8px rgba(102,126,234,0.10); overflow:hidden;">
              <img id="newFirearmImageImg" src="" alt="Firearm" style="display:none; width:100%; height:100%; object-fit:cover; border-radius:50%; position:absolute; left:0; top:0;" />
              <i class="fa fa-crosshairs" id="newFirearmImageIcon"></i>
              <span style="position:absolute; bottom:8px; right:8px; background:rgba(30,32,44,0.85); border-radius:50%; padding:7px; display:flex; align-items:center; justify-content:center; transition:background 0.2s;">
                <i class="fa fa-camera" style="font-size:1.55rem; color:#f7fafc;"></i>
              </span>
              <input type="file" id="newFirearmImageInput" accept="image/*" style="display:none;" />
            </div>
            <div style="font-size:1.1rem; color:#a0aec0; margin-bottom:0.5rem;">Firearm Photo</div>
          </div>
          <div style="flex:2 1 320px; min-width:260px;">
            <div style="font-size:1.2rem; font-weight:600; color:#f7fafc; margin-bottom:0.7rem;">Firearm Information</div>
            <div style="display:flex; gap:1.2rem; flex-wrap:wrap;">
              <div style="flex:1 1 140px; min-width:120px; margin-bottom:1rem;">
                <label for="newFirearmSerial" style="color:#e0e7ff; font-weight:500;">Serial Number*</label>
                <div style="display:flex; align-items:center; gap:0.5rem;">
                  <input id="newFirearmSerial" name="serialNumber" type="text" class="heroui-input firearm-input" style="width:100%; margin-top:0.2rem;" required placeholder="Serial Number" />
                  <button type="button" id="generateNewSerialBtn" style="background:linear-gradient(135deg,#10b981 0%,#059669 100%); color:#fff; border:none; border-radius:8px; padding:0.5rem 1rem; font-size:0.9rem; font-weight:500; cursor:pointer; transition:all 0.2s ease; box-shadow:0 2px 8px rgba(16,185,129,0.15); display:flex; align-items:center; gap:0.5rem;"><i class="fa fa-magic"></i> Generate</button>
                </div>
              </div>
            </div>
            <div style="display:flex; gap:1.2rem; flex-wrap:wrap;">
              <div style="flex:1 1 140px; min-width:120px; margin-bottom:1rem;">
                <label for="newFirearmName" style="color:#e0e7ff; font-weight:500;">Name*</label>
                <input id="newFirearmName" name="name" type="text" class="heroui-input firearm-input" style="width:100%; margin-top:0.2rem;" required placeholder="Firearm Name" />
              </div>
            </div>
            <div style="display:flex; gap:1.2rem; flex-wrap:wrap;">
              <div style="flex:1 1 120px; min-width:100px; margin-bottom:1rem;">
                <label for="newFirearmType" style="color:#e0e7ff; font-weight:500;">Type*</label>
                <input id="newFirearmType" name="weaponType" type="text" class="heroui-input firearm-input" style="width:100%; margin-top:0.2rem;" required placeholder="Type (e.g. Pistol, Rifle)" />
              </div>
              <div style="flex:1 1 120px; min-width:100px; margin-bottom:1rem;">
                <label for="newFirearmCaliber" style="color:#e0e7ff; font-weight:500;">Caliber</label>
                <input id="newFirearmCaliber" name="caliber" type="text" class="heroui-input firearm-input" style="width:100%; margin-top:0.2rem;" placeholder="Caliber" />
              </div>
            </div>
            <div style="display:flex; gap:1.2rem; flex-wrap:wrap;">
              <div style="flex:1 1 120px; min-width:100px; margin-bottom:1rem;">
                <label for="newFirearmColor" style="color:#e0e7ff; font-weight:500;">Color</label>
                <input id="newFirearmColor" name="color" type="text" class="heroui-input firearm-input" style="width:100%; margin-top:0.2rem;" placeholder="Color" />
              </div>
                              <div style="flex:1 1 120px; min-width:100px; margin-bottom:1rem;">
                  <label for="newFirearmIsStolen" style="color:#e0e7ff; font-weight:500;">Stolen Status</label>
                  <select id="newFirearmIsStolen" name="isStolen" class="heroui-input firearm-input" style="width:100%; margin-top:0.2rem;">
                    <option value="false">No</option>
                    <option value="true">Yes</option>
                  </select>
                </div>
              </div>
              
            <div style="display:flex; gap:0.75rem; margin-top:1.5rem; justify-content:flex-end;">
              <button class="btn btn-secondary" id="newFirearmModalCancel" type="button" style="background:#35385a; color:#fff; border:none; border-radius:8px; padding:0.6rem 1.2rem; font-weight:500;">Cancel</button>
              <button class="btn btn-primary" id="createFirearmBtn" type="submit" style="background:linear-gradient(135deg,#667eea 0%,#764ba2 100%); color:#fff; border:none; border-radius:8px; padding:0.6rem 1.2rem; font-weight:500;">Create Firearm</button>
            </div>
          </div>
        </div>
      </form>
    </div>
  </div>

  <!-- Call 911 Modal -->
  <div id="call911Modal" class="heroui-modal" style="display:none; position:fixed; z-index:2000; left:0; top:0; width:100vw; height:100vh; background:rgba(30,32,44,0.65); align-items:center; justify-content:center;">
    <div class="heroui-modal-content" style="background:#23263a; border-radius:16px; max-width:600px; width:98%; margin:auto; box-shadow:0 8px 32px rgba(0,0,0,0.25); padding:2.5rem 2rem 2rem 2rem; position:relative; max-height:90vh; overflow-y:auto;">
      <button id="call911ModalClose" aria-label="Close" style="position:absolute; top:1.2rem; right:1.2rem; background:none; border:none; color:#fff; font-size:1.5rem; cursor:pointer; opacity:0.7;"><i class="fa fa-times"></i></button>
      <div style="font-size:1.5rem; font-weight:700; color:#f7fafc; margin-bottom:1.5rem;">
        <i class="fa fa-exclamation-triangle" style="color:#f56565; margin-right:0.5rem;"></i>
        Emergency 911 Call
      </div>
      <form id="call911Form" autocomplete="off">
        <div style="margin-bottom:1.5rem;">
          <label for="call911Name" style="color:#e0e7ff; font-weight:500; display:block; margin-bottom:0.5rem;">Your Name*</label>
          <input id="call911Name" name="name" type="text" class="heroui-input" style="width:100%; height:44px; background:#1e2028; color:#f7fafc; border:1.5px solid #35385a; border-radius:8px; font-size:1rem; font-weight:500; padding-left:1rem; padding-right:1rem;" required placeholder="Enter your full name" maxlength="100" />
        </div>
        
        <div style="margin-bottom:1.5rem;">
          <label for="call911Location" style="color:#e0e7ff; font-weight:500; display:block; margin-bottom:0.5rem;">Location*</label>
          <input id="call911Location" name="location" type="text" class="heroui-input" style="width:100%; height:44px; background:#1e2028; color:#f7fafc; border:1.5px solid #35385a; border-radius:8px; font-size:1rem; font-weight:500; padding-left:1rem; padding-right:1rem;" required placeholder="Enter location (e.g. 123 Main St, Downtown)" maxlength="100" />
        </div>
        
        <div style="margin-bottom:1.5rem;">
          <label for="call911PeopleDescription" style="color:#e0e7ff; font-weight:500; display:block; margin-bottom:0.5rem;">Description of People Involved*</label>
          <textarea id="call911PeopleDescription" name="peopleDescription" class="heroui-input" style="width:100%; min-height:80px; background:#1e2028; color:#f7fafc; border:1.5px solid #35385a; border-radius:8px; font-size:1rem; font-weight:500; padding:1rem; resize:vertical;" required placeholder="Describe the people involved (names, physical descriptions, clothing, etc.)" maxlength="500"></textarea>
        </div>
        
        <div style="margin-bottom:2rem;">
          <label for="call911Description" style="color:#e0e7ff; font-weight:500; display:block; margin-bottom:0.5rem;">Description of What is Happening*</label>
          <textarea id="call911Description" name="callDescription" class="heroui-input" style="width:100%; min-height:80px; background:#1e2028; color:#f7fafc; border:1.5px solid #35385a; border-radius:8px; font-size:1rem; font-weight:500; padding:1rem; resize:vertical;" required placeholder="Describe what is happening or what happened (be as detailed as possible)" maxlength="500"></textarea>
        </div>
        
        <div style="display:flex; gap:0.75rem; justify-content:flex-end;">
          <button class="btn btn-secondary" id="call911ModalCancel" type="button" style="background:#35385a; color:#fff; border:none; border-radius:8px; padding:0.6rem 1.2rem; font-weight:500;">Cancel</button>
          <button class="btn btn-danger" id="submit911Call" type="submit" style="background:linear-gradient(135deg,#f56565 0%,#e53e3e 100%); color:#fff; border:none; border-radius:8px; padding:0.6rem 1.2rem; font-weight:500;">
            <i class="fa fa-exclamation-triangle" style="margin-right:0.5rem;"></i>
            Submit Emergency Call
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- HeroUI Pro Notifications Modal -->
  <div id="notificationModal" class="heroui-modal" style="display:none; position:fixed; z-index:2000; left:0; top:0; width:100vw; height:100vh; background:rgba(30,32,44,0.65); align-items:center; justify-content:center;">
    <div class="heroui-modal-content" style="background:#23263a; border-radius:16px; max-width:800px; width:98%; margin:auto; box-shadow:0 8px 32px rgba(0,0,0,0.25); padding:2.5rem 2rem 2rem 2rem; position:relative; max-height:90vh; overflow-y:auto;">
      <button id="notificationModalClose" aria-label="Close" style="position:absolute; top:1.2rem; right:1.2rem; background:none; border:none; color:#fff; font-size:1.5rem; cursor:pointer; opacity:0.7;"><i class="fa fa-times"></i></button>
      <div style="font-size:1.5rem; font-weight:700; color:#f7fafc; margin-bottom:1.5rem;">
        <i class="fa fa-bell" style="color:#667eea; margin-right:0.5rem;"></i>
        Notifications
      </div>
      
      <!-- Error Alert -->
      <div id="notification-error" style="display:none; background:#f56565; color:#fff; border-radius:8px; padding:1rem; margin-bottom:1.5rem; border:1px solid #e53e3e;">
        <div style="display:flex; align-items:center; justify-content:space-between;">
          <div style="display:flex; align-items:center; gap:0.5rem;">
            <i class="fa fa-exclamation-triangle"></i>
            <strong>Error!</strong> <span id="notification-error-message"></span>
          </div>
          <button type="button" onclick="$('#notification-error').hide()" style="background:none; border:none; color:#fff; font-size:1.2rem; cursor:pointer;">
            <i class="fa fa-times"></i>
          </button>
        </div>
      </div>
      
      <!-- Loading State -->
      <div id="notification-loading" style="display:flex; justify-content:center; align-items:center; padding:3rem;">
        <div style="width:40px; height:40px; border:4px solid #35385a; border-top:4px solid #667eea; border-radius:50%; animation:spin 1s linear infinite;"></div>
      </div>
      
      <!-- Notifications List -->
      <div id="notification-list" style="display:none; max-height:60vh; overflow-y:auto;">
        <!-- Dynamic notifications will be loaded here -->
      </div>
      
      <!-- No Notifications State -->
      <div id="no-notifications" style="display:none; text-align:center; padding:3rem; color:#a0aec0;">
        <i class="fa fa-bell-slash" style="font-size:3rem; margin-bottom:1rem; opacity:0.5;"></i>
        <p style="font-style:italic; font-size:1.1rem; margin:0;">No notifications found.</p>
      </div>
      
      <!-- Load More Button -->
      <div id="notification-load-more" style="display:none; text-align:center; margin-top:1.5rem;">
        <button onclick="loadMoreNotifications()" style="background:linear-gradient(135deg,#667eea 0%,#764ba2 100%); color:#fff; border:none; border-radius:8px; padding:0.75rem 1.5rem; font-weight:500; cursor:pointer; transition:all 0.2s;">
          <i class="fa fa-plus" style="margin-right:0.5rem;"></i>
          Load More
        </button>
      </div>
      
      <!-- Close Button -->
      <div style="display:flex; justify-content:flex-end; margin-top:2rem;">
        <button id="notificationModalCancel" type="button" style="background:#35385a; color:#fff; border:none; border-radius:8px; padding:0.6rem 1.2rem; font-weight:500; cursor:pointer;">
          Close
        </button>
      </div>
    </div>
  </div>

  <!-- HeroUI Pro Notification Menu Modal -->
  <div id="notificationMenuModal" class="heroui-modal" style="display:none; position:fixed; z-index:2001; left:0; top:0; width:100vw; height:100vh; background:rgba(30,32,44,0.65); align-items:center; justify-content:center;">
    <div class="heroui-modal-content" style="background:#23263a; border-radius:16px; max-width:400px; width:98%; margin:auto; box-shadow:0 8px 32px rgba(0,0,0,0.25); padding:2rem; position:relative;">
      <button id="notificationMenuModalClose" aria-label="Close" style="position:absolute; top:1.2rem; right:1.2rem; background:none; border:none; color:#fff; font-size:1.5rem; cursor:pointer; opacity:0.7;"><i class="fa fa-times"></i></button>
      <div style="font-size:1.3rem; font-weight:700; color:#f7fafc; margin-bottom:1.5rem;">
        <i class="fa fa-cog" style="color:#667eea; margin-right:0.5rem;"></i>
        Notification Options
      </div>
      <div style="display:flex; flex-direction:column; gap:0.75rem;">
        <button onclick="markNotificationAsRead()" style="background:#35385a; color:#fff; border:none; border-radius:8px; padding:0.75rem 1rem; font-weight:500; cursor:pointer; transition:all 0.2s; text-align:left;">
          <i class="fa fa-check" style="margin-right:0.5rem; color:#48bb78;"></i>
          Mark as Read
        </button>
        <button onclick="deleteNotification()" style="background:#f56565; color:#fff; border:none; border-radius:8px; padding:0.75rem 1rem; font-weight:500; cursor:pointer; transition:all 0.2s; text-align:left;">
          <i class="fa fa-trash" style="margin-right:0.5rem;"></i>
          Delete
        </button>
      </div>
    </div>
  </div>

  <!-- HeroUI Pro Account Settings Modal -->
  <div id="accountModal" class="heroui-modal" style="display:none; position:fixed; z-index:2000; left:0; top:0; width:100vw; height:100vh; background:rgba(30,32,44,0.65); align-items:center; justify-content:center;">
    <div class="heroui-modal-content" style="background:#23263a; border-radius:16px; max-width:900px; width:98%; margin:auto; box-shadow:0 8px 32px rgba(0,0,0,0.25); padding:2.5rem 2rem 2rem 2rem; position:relative; max-height:90vh; overflow-y:auto;">
      <button id="accountModalClose" aria-label="Close" style="position:absolute; top:1.2rem; right:1.2rem; background:none; border:none; color:#fff; font-size:1.5rem; cursor:pointer; opacity:0.7;"><i class="fa fa-times"></i></button>
      
      <!-- Success Alert -->
      <div id="successfully-updated-alert" style="display:none; background:#48bb78; color:#fff; border-radius:8px; padding:1rem; margin-bottom:1.5rem; border:1px solid #38a169;">
        <div style="display:flex; align-items:center; gap:0.5rem;">
          <i class="fa fa-check-circle"></i>
          <strong>Success!</strong> Settings updated successfully.
        </div>
      </div>
      
      <div style="font-size:1.5rem; font-weight:700; color:#f7fafc; margin-bottom:1.5rem;">
        <i class="fa fa-user-cog" style="color:#667eea; margin-right:0.5rem;"></i>
        Account Settings
      </div>
      
      <!-- Tabs -->
      <div class="heroui-tabs" style="display:flex; gap:1.2rem; border-bottom:1.5px solid #35385a; margin-bottom:2rem;">
        <button class="heroui-tab active" data-tab="account" style="background:none; border:none; color:#fff; font-size:1.1rem; font-weight:600; padding:0.5rem 1.2rem; border-radius:8px 8px 0 0; cursor:pointer;">Account</button>
        <button class="heroui-tab" data-tab="settings" style="background:none; border:none; color:#a0aec0; font-size:1.1rem; font-weight:600; padding:0.5rem 1.2rem; border-radius:8px 8px 0 0; cursor:pointer;">Settings</button>
      </div>
      
      <!-- Tab Content -->
      <div class="heroui-tab-content" id="accountTabContent-account" style="display: block;">
        <!-- Account Tab -->
        <form id="accountForm" action="/manageAccount" method="post">
          <div style="display:flex; gap:2rem; align-items:flex-start; flex-wrap:wrap;">
            <!-- Profile Section -->
            <div style="flex:1 1 300px; min-width:280px;">
              <div style="font-size:1.2rem; font-weight:600; color:#f7fafc; margin-bottom:1rem;">
                <i class="fa fa-user" style="color:#667eea; margin-right:0.5rem;"></i>
                Profile
              </div>
              
              <!-- Profile Picture -->
              <div style="text-align:center; margin-bottom:2rem;">
                <div id="accountProfilePicUpload" style="width:120px; height:120px; border-radius:50%; background:linear-gradient(135deg,#667eea 0%,#764ba2 100%); display:flex; align-items:center; justify-content:center; font-size:3rem; color:#fff; margin:0 auto 1rem; border:3px solid #35385a; position:relative; cursor:pointer; transition:box-shadow 0.25s, border 0.25s; background-size: cover; background-position: center; overflow: hidden;">
                  <img id="accountProfilePicImg" src="<%= user.user.profilePicture || '' %>" alt="Profile Picture" style="display: none; width: 100%; height: 100%; object-fit: cover; border-radius: 50%; position: absolute; left: 0; top: 0;">
                  <i class="fa fa-user" id="accountProfilePicIcon"></i>
                  <span style="position:absolute; bottom:12px; right:12px; background:rgba(30,32,44,0.85); border-radius:50%; padding:10px; display:flex; align-items:center; justify-content:center; transition:background 0.2s;">
                    <i class="fa fa-camera" style="font-size:1.55rem; color:#f7fafc;"></i>
                  </span>
                </div>
              </div>
              
              <!-- Email -->
              <div style="margin-bottom:1.5rem;">
                <label for="accountEmail" style="color:#e0e7ff; font-weight:500; display:block; margin-bottom:0.5rem;">Email Address</label>
                <input id="accountEmail" name="accountEmail" type="email" class="heroui-input" style="width:100%; height:44px; background:#1e2028; color:#f7fafc; border:1.5px solid #35385a; border-radius:8px; font-size:1rem; font-weight:500; padding-left:1rem; padding-right:1rem;" readonly>
              </div>
            </div>
            
            <!-- Account Details Section -->
            <div style="flex:2 1 400px; min-width:320px;">
              <div style="font-size:1.2rem; font-weight:600; color:#f7fafc; margin-bottom:1rem;">
                <i class="fa fa-id-card" style="color:#667eea; margin-right:0.5rem;"></i>
                Account Details
              </div>
              
              <!-- Username -->
              <div style="margin-bottom:1.5rem;">
                <label for="accountUsername" style="color:#e0e7ff; font-weight:500; display:block; margin-bottom:0.5rem;">Username <span style="color:#a0aec0; font-size:0.9rem;">(Max 20 characters)</span></label>
                <input id="accountUsername" name="accountUsername" type="text" class="heroui-input" style="width:100%; height:44px; background:#1e2028; color:#f7fafc; border:1.5px solid #35385a; border-radius:8px; font-size:1rem; font-weight:500; padding-left:1rem; padding-right:1rem;" maxlength="20" autocomplete="off" required>
                <div id="updateUsernameBtns" style="display:none; margin-top:1rem;">
                  <input type="hidden" name="userID" value="<%= user._id %>">
                  <input type="hidden" name="page" value="/civ-dashboard">
                  <button id="updateUsername" value="updateUsername" name="action" style="background:#667eea; color:#fff; border:none; border-radius:8px; padding:0.6rem 1.2rem; font-weight:500; margin-right:0.5rem;">Update Username</button>
                  <button type="button" onclick="cancelUsername()" style="background:#35385a; color:#fff; border:none; border-radius:8px; padding:0.6rem 1.2rem; font-weight:500;">Cancel</button>
                </div>
              </div>
              
              <!-- Call Sign -->
              <div style="margin-bottom:1.5rem;">
                <label for="accountCallSign" style="color:#e0e7ff; font-weight:500; display:block; margin-bottom:0.5rem;">Call Sign <span style="color:#a0aec0; font-size:0.9rem;">(Max 10 characters)</span></label>
                <input id="accountCallSign" name="accountCallSign" type="text" class="heroui-input" style="width:100%; height:44px; background:#1e2028; color:#f7fafc; border:1.5px solid #35385a; border-radius:8px; font-size:1rem; font-weight:500; padding-left:1rem; padding-right:1rem;" maxlength="10" autocomplete="off" required>
                <div id="updateCallSignBtns" style="display:none; margin-top:1rem;">
                  <input type="hidden" name="page" value="/civ-dashboard">
                  <button id="updateCallSign" value="updateCallSign" name="action" style="background:#667eea; color:#fff; border:none; border-radius:8px; padding:0.6rem 1.2rem; font-weight:500; margin-right:0.5rem;">Update Call Sign</button>
                  <button type="button" onclick="cancelCallSign()" style="background:#35385a; color:#fff; border:none; border-radius:8px; padding:0.6rem 1.2rem; font-weight:500;">Cancel</button>
                </div>
              </div>
            </div>
          </div>
          
          <!-- Security Section -->
          <div style="margin-top:2rem; padding-top:2rem; border-top:1px solid #35385a;">
            <div style="font-size:1.2rem; font-weight:600; color:#f7fafc; margin-bottom:1rem;">
              <i class="fa fa-lock" style="color:#667eea; margin-right:0.5rem;"></i>
              Security
            </div>
            
            <div style="display:flex; gap:1rem; flex-wrap:wrap;">
              <button type="button" onclick="window.location.href='forgot-password'" style="background:linear-gradient(135deg,#667eea 0%,#764ba2 100%); color:#fff; border:none; border-radius:8px; padding:0.75rem 1.5rem; font-weight:500; cursor:pointer; transition:all 0.2s;">
                <i class="fa fa-key" style="margin-right:0.5rem;"></i>
                Update Password
              </button>
            </div>
          </div>
          
          <!-- Discord Section -->
          <div style="margin-top:2rem; padding-top:2rem; border-top:1px solid #35385a;">
            <div style="font-size:1.2rem; font-weight:600; color:#f7fafc; margin-bottom:1rem;">
              <i class="fab fa-discord" style="color:#667eea; margin-right:0.5rem;"></i>
              Discord Integration
            </div>
            
            <div style="display:flex; align-items:center; gap:1rem; flex-wrap:wrap;">
              <img alt="discord" style="width:40px; height:40px;" src="./static/images/discord-icon.svg">
              <input id="link" type="text" name="discordToken" value="<%= user.user.discordLoginToken %>" style="display:none;">
              
              <% if (user.user.discordConnected) { %>
                <div style="display:flex; align-items:center; gap:0.5rem; color:#48bb78;">
                  <i class="fa fa-check-circle"></i>
                  <strong>Discord account connected</strong>
                </div>
                <button name="action" value="disconnectDiscord" type="submit" style="background:#f56565; color:#fff; border:none; border-radius:8px; padding:0.75rem 1.5rem; font-weight:500; cursor:pointer; transition:all 0.2s;">
                  <i class="fa fa-unlink" style="margin-right:0.5rem;"></i>
                  Disconnect Discord
                </button>
              <% } else { %>
                <div style="display:flex; align-items:center; gap:0.5rem; color:#f56565;">
                  <i class="fa fa-times-circle"></i>
                  <strong>Discord account not connected</strong>
                </div>
                <a href="https://discord.com/api/oauth2/authorize?client_id=1005557484271976569&redirect_uri=<%=redirect%>&response_type=code&scope=identify&state=<%=referer%>" style="background:linear-gradient(135deg,#667eea 0%,#764ba2 100%); color:#fff; border:none; border-radius:8px; padding:0.75rem 1.5rem; font-weight:500; cursor:pointer; transition:all 0.2s; text-decoration:none; display:inline-flex; align-items:center;">
                  <i class="fa fa-link" style="margin-right:0.5rem;"></i>
                  Connect Discord
                  <i class="fa fa-external-link-alt" style="margin-left:0.5rem; font-size:0.9rem;"></i>
                </a>
              <% } %>
            </div>
          </div>
          
          <!-- Account Actions Section -->
          <div style="margin-top:2rem; padding-top:2rem; border-top:1px solid #35385a;">
            <div style="font-size:1.2rem; font-weight:600; color:#f7fafc; margin-bottom:1rem;">
              <i class="fa fa-sign-out" style="color:#667eea; margin-right:0.5rem;"></i>
              Account Actions
            </div>
            <div style="display:flex; gap:1rem; flex-wrap:wrap;">
              <button type="button" onclick="window.location.href='logout'" style="background:#35385a; color:#fff; border:none; border-radius:8px; padding:0.75rem 1.5rem; font-weight:500; cursor:pointer; transition:all 0.2s;">
                <i class="fa fa-sign-out" style="margin-right:0.5rem;"></i>
                Sign Out
              </button>
            </div>
          </div>
          <!-- Advanced Section -->
          <div style="margin-top:2rem; padding-top:2rem; border-top:1px solid #35385a;">
            <div style="font-size:1.2rem; font-weight:600; color:#f56565; margin-bottom:1rem;">
              <i class="fa fa-exclamation-triangle" style="color:#f56565; margin-right:0.5rem;"></i>
              Advanced
            </div>
            <button type="button" onclick="openDeactivateModal()" style="background:#f56565; color:#fff; border:none; border-radius:8px; padding:0.75rem 1.5rem; font-weight:500; cursor:pointer; transition:all 0.2s;">
              <i class="fa fa-user-slash" style="margin-right:0.5rem;"></i>
              Deactivate
            </button>
          </div>
         </form>
       </div>
       
       <div class="heroui-tab-content" id="accountTabContent-settings" style="display:none;">
         <!-- Settings Tab -->
         <form id="settingsForm" action="/updateSettings" method="post">
           <div style="font-size:1.2rem; font-weight:600; color:#f7fafc; margin-bottom:1.5rem;">
             <i class="fa fa-cog" style="color:#667eea; margin-right:0.5rem;"></i>
             Application Settings
           </div>
           
           <!-- Panic Button Settings -->
           <div style="margin-bottom:2rem; padding:1.5rem; background:#1e2028; border-radius:8px; border:1px solid #35385a;">
             <div style="font-size:1.1rem; font-weight:600; color:#f7fafc; margin-bottom:1rem;">
               <i class="fa fa-exclamation-triangle" style="color:#f56565; margin-right:0.5rem;"></i>
               Panic Button
             </div>
             
             <div style="display:flex; align-items:center; gap:1rem;">
               <label style="display:flex; align-items:center; gap:0.5rem; color:#e0e7ff; cursor:pointer;">
                 <input id="panic-button-check-sound" type="checkbox" name="enableSound" style="width:18px; height:18px; accent-color:#667eea;">
                 Enable Sound
               </label>
             </div>
           </div>
           
           <!-- Alert Volume Settings -->
           <div style="margin-bottom:2rem; padding:1.5rem; background:#1e2028; border-radius:8px; border:1px solid #35385a;">
             <div style="font-size:1.1rem; font-weight:600; color:#f7fafc; margin-bottom:1rem;">
               <i class="fa fa-volume-up" style="color:#667eea; margin-right:0.5rem;"></i>
               Alert Volume
               <a href="#" onclick="openAlertVolumeHelp()" style="color:#667eea; margin-left:0.5rem; text-decoration:none;">
                 <i class="fa fa-question-circle"></i>
               </a>
             </div>
             
             <div style="display:flex; align-items:center; gap:1rem;">
               <label style="color:#e0e7ff; font-weight:500;">Volume Level:</label>
               <input type="range" id="alert-volume-slider" min="0" max="100" style="flex:1; height:6px; background:#35385a; border-radius:3px; outline:none; accent-color:#667eea;">
               <span id="volume-display" style="color:#a0aec0; font-weight:500; min-width:40px; text-align:center;">50</span>
             </div>
           </div>
           
           <!-- Additional Settings Section -->
           <div style="margin-top:2rem; padding-top:2rem; border-top:1px solid #35385a;">
             <div style="font-size:1.2rem; font-weight:600; color:#f7fafc; margin-bottom:1.5rem;">
               <i class="fa fa-bell" style="color:#667eea; margin-right:0.5rem;"></i>
               Notification Settings
             </div>
             
             <!-- Notification Preferences -->
             <div style="margin-bottom:2rem; padding:1.5rem; background:#1e2028; border-radius:8px; border:1px solid #35385a;">
               <div style="font-size:1.1rem; font-weight:600; color:#f7fafc; margin-bottom:1rem;">
                 <i class="fa fa-bell" style="color:#667eea; margin-right:0.5rem;"></i>
                 Notification Preferences
               </div>
               
               <div style="display:flex; flex-direction:column; gap:1rem;">
                 <label style="display:flex; align-items:center; gap:0.5rem; color:#e0e7ff; cursor:pointer;">
                   <input id="enable-email-notifications" type="checkbox" name="emailNotifications" style="width:18px; height:18px; accent-color:#667eea;">
                   Enable Email Notifications
                 </label>
                 <label style="display:flex; align-items:center; gap:0.5rem; color:#e0e7ff; cursor:pointer;">
                   <input id="enable-push-notifications" type="checkbox" name="pushNotifications" style="width:18px; height:18px; accent-color:#667eea;">
                   Enable Push Notifications
                 </label>
                 <label style="display:flex; align-items:center; gap:0.5rem; color:#e0e7ff; cursor:pointer;">
                   <input id="enable-sound-notifications" type="checkbox" name="soundNotifications" style="width:18px; height:18px; accent-color:#667eea;">
                   Enable Sound Notifications
                 </label>
               </div>
             </div>
           </div>
         </form>
       </div>
    </div>
  </div>

  <!-- HeroUI Pro Delete Account Confirmation Modal -->
  <div id="deleteAccountConfirmModal" class="heroui-modal" style="display:none; position:fixed; z-index:2001; left:0; top:0; width:100vw; height:100vh; background:rgba(30,32,44,0.65); align-items:center; justify-content:center;">
    <div class="heroui-modal-content" style="background:#23263a; border-radius:16px; max-width:500px; width:98%; margin:auto; box-shadow:0 8px 32px rgba(0,0,0,0.25); padding:2rem; position:relative;">
      <button id="deleteAccountConfirmModalClose" aria-label="Close" style="position:absolute; top:1.2rem; right:1.2rem; background:none; border:none; color:#fff; font-size:1.5rem; cursor:pointer; opacity:0.7;"><i class="fa fa-times"></i></button>
      <div style="font-size:1.3rem; font-weight:700; color:#f7fafc; margin-bottom:1.5rem;">
        <i class="fa fa-exclamation-triangle" style="color:#f56565; margin-right:0.5rem;"></i>
        Delete Account
      </div>
      
      <div style="color:#e0e7ff; margin-bottom:1.5rem; line-height:1.6;">
        <p style="margin-bottom:1rem;"><strong>Warning:</strong> This action is irreversible.</p>
        <p style="margin-bottom:1rem;">Once your account is deleted, all created communities, civilians, vehicles, and citations from this account will be permanently removed.</p>
        <p>Are you sure you want to delete your account?</p>
      </div>
      
      <form action="/deleteAccount" method="post" style="display:flex; gap:0.75rem; justify-content:flex-end;">
        <input type="hidden" name="page" value="/civ-dashboard">
        <button type="button" onclick="closeDeleteAccountModal()" style="background:#35385a; color:#fff; border:none; border-radius:8px; padding:0.6rem 1.2rem; font-weight:500; cursor:pointer;">
          Cancel
        </button>
        <button type="submit" value="<%= user._id %>" name="userID" style="background:#f56565; color:#fff; border:none; border-radius:8px; padding:0.6rem 1.2rem; font-weight:500; cursor:pointer;">
          <i class="fa fa-trash" style="margin-right:0.5rem;"></i>
          Delete Account
        </button>
      </form>
    </div>
  </div>

  <!-- License Details Modal -->
  <div id="licenseDetailsModal" class="heroui-modal" style="display:none; position:fixed; z-index:2001; left:0; top:0; width:100vw; height:100vh; background:rgba(30,32,44,0.65); align-items:center; justify-content:center;">
    <div class="heroui-modal-content" style="background:#23263a; border-radius:16px; max-width:600px; width:98%; margin:auto; box-shadow:0 8px 32px rgba(0,0,0,0.25); padding:2rem; position:relative; max-height:90vh; overflow-y:auto;">
      <button id="licenseDetailsModalClose" aria-label="Close" style="position:absolute; top:1.2rem; right:1.2rem; background:none; border:none; color:#fff; font-size:1.5rem; cursor:pointer; opacity:0.7;"><i class="fa fa-times"></i></button>
      
      <div style="font-size:1.3rem; font-weight:700; color:#f7fafc; margin-bottom:1.5rem;">
        <i class="fa fa-id-card" style="color:#667eea; margin-right:0.5rem;"></i>
        License Details
      </div>
      
      <div class="heroui-tabs" style="display:flex; gap:0.5rem; margin-bottom:2rem; border-bottom:1px solid #35385a; padding-bottom:1rem;">
        <button class="heroui-tab active" data-tab="edit" style="background:none; border:none; color:#fff; font-size:1rem; font-weight:600; padding:0.5rem 1rem; border-radius:6px; cursor:pointer;">Edit</button>
        <button class="heroui-tab" data-tab="details" style="background:none; border:none; color:#a0aec0; font-size:1rem; font-weight:600; padding:0.5rem 1rem; border-radius:6px; cursor:pointer;">Details</button>
      </div>
      
      <!-- Edit Tab -->
      <div class="heroui-tab-content" id="licenseTabContent-edit" style="display:block;">
        <form id="editLicenseForm">
          <input type="hidden" id="licenseIdHidden">
          
          <div style="margin-bottom:1.5rem;">
            <label for="licenseType" style="color:#e0e7ff; font-weight:500; display:block; margin-bottom:0.5rem;">License Type *</label>
            <input id="licenseType" name="licenseType" type="text" class="license-input" style="width:100%; height:44px; background:#1e2028; color:#f7fafc; border:1.5px solid #35385a; border-radius:8px; font-size:1rem; font-weight:500; padding-left:1rem; padding-right:1rem;" placeholder="e.g., Driver's License" required>
          </div>
          
          <div style="margin-bottom:1.5rem;">
            <label for="licenseStatus" style="color:#e0e7ff; font-weight:500; display:block; margin-bottom:0.5rem;">Status *</label>
            <select id="licenseStatus" name="licenseStatus" class="license-input" style="width:100%; height:44px; background:#1e2028; color:#f7fafc; border:1.5px solid #35385a; border-radius:8px; font-size:1rem; font-weight:500; padding-left:1rem; padding-right:1rem;" required>
              <option value="Pending">Pending</option>
              <option value="Valid">Valid</option>
              <option value="Approved">Approved</option>
              <option value="Suspended">Suspended</option>
              <option value="Revoked">Revoked</option>
            </select>
          </div>
          
          <div style="margin-bottom:1.5rem;">
            <label for="licenseExpiry" style="color:#e0e7ff; font-weight:500; display:block; margin-bottom:0.5rem;">Expiry Date *</label>
            <input id="licenseExpiry" name="licenseExpiry" type="date" class="license-input" style="width:100%; height:44px; background:#1e2028; color:#f7fafc; border:1.5px solid #35385a; border-radius:8px; font-size:1rem; font-weight:500; padding-left:1rem; padding-right:1rem;" required>
          </div>
          
          <div style="margin-bottom:2rem;">
            <label for="licenseNotes" style="color:#e0e7ff; font-weight:500; display:block; margin-bottom:0.5rem;">Additional Notes</label>
            <textarea id="licenseNotes" name="licenseNotes" class="license-input" style="width:100%; min-height:80px; background:#1e2028; color:#f7fafc; border:1.5px solid #35385a; border-radius:8px; font-size:1rem; font-weight:500; padding:1rem; resize:vertical;" placeholder="Additional notes (optional)"></textarea>
          </div>
          
          <div style="display:flex; gap:0.75rem; justify-content:flex-end;">
            <button type="button" onclick="closeLicenseDetailsModal()" style="background:#35385a; color:#fff; border:none; border-radius:8px; padding:0.6rem 1.2rem; font-weight:500; cursor:pointer;">
              Cancel
            </button>
            <button type="button" onclick="deleteLicenseModern()" style="background:#f56565; color:#fff; border:none; border-radius:8px; padding:0.6rem 1.2rem; font-weight:500; cursor:pointer;">
              <i class="fa fa-trash" style="margin-right:0.5rem;"></i>
              Delete
            </button>
            <button type="button" onclick="updateLicenseModern()" style="background:#667eea; color:#fff; border:none; border-radius:8px; padding:0.6rem 1.2rem; font-weight:500; cursor:pointer;">
              <i class="fa fa-save" style="margin-right:0.5rem;"></i>
              Update
            </button>
          </div>
        </form>
      </div>
      
      <!-- Details Tab -->
      <div class="heroui-tab-content" id="licenseTabContent-details" style="display:none;">
        <div style="margin-bottom:1.5rem;">
          <label style="color:#e0e7ff; font-weight:500; display:block; margin-bottom:0.5rem;">License Type</label>
          <div id="licenseTypeDisplay" style="padding:0.75rem; background:#1e2028; border:1.5px solid #35385a; border-radius:8px; color:#f7fafc; font-weight:500;"></div>
        </div>
        
        <div style="margin-bottom:1.5rem;">
          <label style="color:#e0e7ff; font-weight:500; display:block; margin-bottom:0.5rem;">Status</label>
          <div id="licenseStatusDisplay" style="padding:0.75rem; background:#1e2028; border:1.5px solid #35385a; border-radius:8px; color:#f7fafc; font-weight:500;"></div>
        </div>
        
        <div style="margin-bottom:1.5rem;">
          <label style="color:#e0e7ff; font-weight:500; display:block; margin-bottom:0.5rem;">Expiry Date</label>
          <div id="licenseExpiryDisplay" style="padding:0.75rem; background:#1e2028; border:1.5px solid #35385a; border-radius:8px; color:#f7fafc; font-weight:500;"></div>
        </div>
        
        <div style="margin-bottom:2rem;">
          <label style="color:#e0e7ff; font-weight:500; display:block; margin-bottom:0.5rem;">Additional Notes</label>
          <div id="licenseNotesDisplay" style="padding:0.75rem; background:#1e2028; border:1.5px solid #35385a; border-radius:8px; color:#f7fafc; font-weight:500; min-height:60px;"></div>
        </div>
        
        <div style="display:flex; gap:0.75rem; justify-content:flex-end;">
          <button type="button" onclick="closeLicenseDetailsModal()" style="background:#35385a; color:#fff; border:none; border-radius:8px; padding:0.6rem 1.2rem; font-weight:500; cursor:pointer;">
            Close
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- New License Modal -->
  <div id="newLicenseModal" class="heroui-modal" style="display:none; position:fixed; z-index:2001; left:0; top:0; width:100vw; height:100vh; background:rgba(30,32,44,0.65); align-items:center; justify-content:center;">
    <div class="heroui-modal-content" style="background:#23263a; border-radius:16px; max-width:500px; width:98%; margin:auto; box-shadow:0 8px 32px rgba(0,0,0,0.25); padding:2rem; position:relative;">
      <button id="newLicenseModalClose" aria-label="Close" style="position:absolute; top:1.2rem; right:1.2rem; background:none; border:none; color:#fff; font-size:1.5rem; cursor:pointer; opacity:0.7;"><i class="fa fa-times"></i></button>
      
      <div style="font-size:1.3rem; font-weight:700; color:#f7fafc; margin-bottom:1.5rem;">
        <i class="fa fa-plus" style="color:#667eea; margin-right:0.5rem;"></i>
        Add New License
      </div>
      
      <form id="createLicenseForm">
        <div style="margin-bottom:1.5rem;">
          <label for="newLicenseType" style="color:#e0e7ff; font-weight:500; display:block; margin-bottom:0.5rem;">License Type *</label>
          <input id="newLicenseType" name="newLicenseType" type="text" class="license-input" style="width:100%; height:44px; background:#1e2028; color:#f7fafc; border:1.5px solid #35385a; border-radius:8px; font-size:1rem; font-weight:500; padding-left:1rem; padding-right:1rem;" placeholder="e.g., Driver's License" required>
        </div>
        
        <div style="margin-bottom:1.5rem;">
          <label for="newLicenseStatus" style="color:#e0e7ff; font-weight:500; display:block; margin-bottom:0.5rem;">Status *</label>
          <select id="newLicenseStatus" name="newLicenseStatus" class="license-input" style="width:100%; height:44px; background:#1e2028; color:#f7fafc; border:1.5px solid #35385a; border-radius:8px; font-size:1rem; font-weight:500; padding-left:1rem; padding-right:1rem;" required>
            <option value="Pending">Pending</option>
            <option value="Valid">Valid</option>
            <option value="Approved">Approved</option>
            <option value="Suspended">Suspended</option>
            <option value="Revoked">Revoked</option>
          </select>
        </div>
        
        <div style="margin-bottom:1.5rem;">
          <label for="newLicenseExpiry" style="color:#e0e7ff; font-weight:500; display:block; margin-bottom:0.5rem;">Expiry Date *</label>
          <input id="newLicenseExpiry" name="newLicenseExpiry" type="date" class="license-input" style="width:100%; height:44px; background:#1e2028; color:#f7fafc; border:1.5px solid #35385a; border-radius:8px; font-size:1rem; font-weight:500; padding-left:1rem; padding-right:1rem;" required>
        </div>
        
        <div style="margin-bottom:2rem;">
          <label for="newLicenseNotes" style="color:#e0e7ff; font-weight:500; display:block; margin-bottom:0.5rem;">Additional Notes</label>
          <textarea id="newLicenseNotes" name="newLicenseNotes" class="license-input" style="width:100%; min-height:80px; background:#1e2028; color:#f7fafc; border:1.5px solid #35385a; border-radius:8px; font-size:1rem; font-weight:500; padding:1rem; resize:vertical;" placeholder="Additional notes (optional)"></textarea>
        </div>
        
        <div style="display:flex; gap:0.75rem; justify-content:flex-end;">
          <button type="button" onclick="closeNewLicenseModal()" style="background:#35385a; color:#fff; border:none; border-radius:8px; padding:0.6rem 1.2rem; font-weight:500; cursor:pointer;">
            Cancel
          </button>
          <button type="button" onclick="createLicenseModern()" style="background:#667eea; color:#fff; border:none; border-radius:8px; padding:0.6rem 1.2rem; font-weight:500; cursor:pointer;">
            <i class="fa fa-plus" style="margin-right:0.5rem;"></i>
            Create License
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- Deactivate Account Modal -->
  <div id="deactivateAccountModal" class="heroui-modal" style="display:none; position:fixed; z-index:2100; left:0; top:0; width:100vw; height:100vh; background:rgba(30,32,44,0.65); align-items:center; justify-content:center;">
    <div class="heroui-modal-content" style="background:#23263a; border-radius:16px; max-width:480px; width:98%; margin:auto; box-shadow:0 8px 32px rgba(0,0,0,0.25); padding:2.5rem 2rem 2rem 2rem; position:relative; max-height:90vh; overflow-y:auto;">
      <button id="deactivateAccountModalClose" aria-label="Close" onclick="closeDeactivateModal()" style="position:absolute; top:1.2rem; right:1.2rem; background:none; border:none; color:#fff; font-size:1.5rem; cursor:pointer; opacity:0.7;"><i class="fa fa-times"></i></button>
      <div style="display:flex; flex-direction:column; align-items:center; gap:1.2rem; margin-bottom:1.5rem;">
        <div style="width:72px; height:72px; border-radius:50%; background:linear-gradient(135deg,#667eea 0%,#764ba2 100%); display:flex; align-items:center; justify-content:center; font-size:2.5rem; color:#fff; border:3px solid #35385a;">
          <i class="fa fa-user"></i>
        </div>
        <div style="text-align:center;">
          <div style="font-size:1.2rem; font-weight:600; color:#f7fafc;">Deactivate your account</div>
          <div style="color:#a0aec0; font-size:1rem; margin-top:0.2rem;">@<%= user.user.username %></div>
        </div>
      </div>
      <div style="margin-bottom:1.5rem;">
        <div style="color:#f7fafc; font-size:1.05rem; font-weight:600; margin-bottom:0.5rem;">This will deactivate your account</div>
        <div style="color:#a0aec0; font-size:0.98rem; margin-bottom:1rem;">You're about to start the process of deactivating your account. Your display name, username, and public profile will no longer be viewable on linespolice-cad.com, LPC-APP for iOS, or LPC-APP for Android.</div>
        <div style="color:#f7fafc; font-size:1.05rem; font-weight:600; margin-bottom:0.5rem;">What else you should know</div>
        <div style="color:#a0aec0; font-size:0.98rem; margin-bottom:0.5rem;">You can restore your LPC account if it was accidentally or wrongfully deactivated for up to 30 days after deactivation.</div>
        <div style="color:#a0aec0; font-size:0.98rem; margin-bottom:0.5rem;">If you have any active paid subscriptions (e.g., Premium) purchased through the LPC app, they will remain active. You can manage these subscriptions through the platform where you originally subscribed. Subscriptions purchased on linespolice-cad.com will automatically cancel after you deactivate your account. <a href="/terms-and-conditions" style="color:#667eea; text-decoration:underline;">Learn more about subscriptions</a></div>
        <div style="color:#a0aec0; font-size:0.98rem; margin-bottom:0.5rem;">Upon deactivating your account, your data will be processed per our <a href="/privacy-policy" style="color:#667eea; text-decoration:underline;">Privacy Policy</a>.</div>
        <div style="color:#a0aec0; font-size:0.98rem; margin-bottom:0.5rem;">If you just want to change your username, you don't need to deactivate your account — edit it in your settings on your <a href="/profile" style="color:#667eea; text-decoration:underline;">Profile Page</a>.</div>
        <div style="color:#a0aec0; font-size:0.98rem;">To use your current email address with a different LPC account, <a href="/profile" style="color:#667eea; text-decoration:underline;">change that</a> before you deactivate this account.</div>
      </div>
      <button id="deactivateAccountBtn" onclick="handleDeactivateAccount()" style="width:100%; background:#f56565; color:#fff; border:none; border-radius:8px; padding:0.85rem 0; font-weight:600; font-size:1.1rem; margin-top:1.2rem; cursor:pointer; transition:all 0.2s;">
        <span id="deactivateAccountBtnText">Deactivate</span>
        <span id="deactivateAccountBtnSpinner" style="display:none; margin-left:0.5rem;"><i class="fa fa-spinner fa-spin"></i></span>
      </button>
    </div>
  </div>
  <script>
  function openDeactivateModal() {
    document.getElementById('deactivateAccountModal').style.display = 'flex';
  }
  function closeDeactivateModal() {
    document.getElementById('deactivateAccountModal').style.display = 'none';
  }
  async function handleDeactivateAccount() {
    var btn = document.getElementById('deactivateAccountBtn');
    var text = document.getElementById('deactivateAccountBtnText');
    var spinner = document.getElementById('deactivateAccountBtnSpinner');
    btn.disabled = true;
    text.style.display = 'none';
    spinner.style.display = 'inline-block';
    try {
      const response = await fetch(`${API_URL}/api/v1/user/<%= user._id %>/deactivate`, {
        method: 'DELETE',
        headers: {
          'Content-Type': 'application/json',
        },
      });
      if (response.ok) {
        alert('Your account has been deactivated. You can reactivate it within 30 days by contacting us.');
        window.location.href = '/logout';
      } else {
        const data = await response.json().catch(() => ({}));
        alert(data.message || 'There was an error deactivating your account. Please try again later.');
      }
    } catch (e) {
      alert('There was an error deactivating your account. Please try again later.');
    } finally {
      btn.disabled = false;
      text.style.display = 'inline';
      spinner.style.display = 'none';
    }
  }
  </script>

  <!-- Coming Soon Modal -->
  <div id="comingSoonModal" class="heroui-modal" style="display:none; position:fixed; z-index:2200; left:0; top:0; width:100vw; height:100vh; background:rgba(30,32,44,0.65); align-items:center; justify-content:center;">
    <div class="heroui-modal-content" style="background:#23263a; border-radius:16px; max-width:340px; width:98%; margin:auto; box-shadow:0 8px 32px rgba(0,0,0,0.25); padding:2rem 1.5rem 1.5rem 1.5rem; position:relative; text-align:center;">
      <button aria-label="Close" onclick="closeComingSoonModal()" style="position:absolute; top:1.2rem; right:1.2rem; background:none; border:none; color:#fff; font-size:1.5rem; cursor:pointer; opacity:0.7;"><i class="fa fa-times"></i></button>
      <div style="font-size:2.5rem; color:#f093fb; margin-bottom:1rem;"><i class="fa fa-hammer"></i></div>
      <div style="font-size:1.3rem; font-weight:700; color:#f7fafc; margin-bottom:0.5rem;">Coming Soon</div>
      <div style="color:#a0aec0; font-size:1rem;">Photo uploads are still under construction.<br>Check back soon!</div>
    </div>
  </div>
  <script>
  function openComingSoonModal() {
    document.getElementById('comingSoonModal').style.display = 'flex';
  }
  function closeComingSoonModal() {
    document.getElementById('comingSoonModal').style.display = 'none';
  }
  document.addEventListener('DOMContentLoaded', function() {
    // Initialize profile pictures
    initializeProfilePictures();
    
    // Intercept all file input clicks for image uploads
    var fileInputs = [
      document.getElementById('civImageInput'),
      document.getElementById('vehImageInput'),
      document.getElementById('newVehImageInput'),
      document.getElementById('firearmImageInput'),
      document.getElementById('newFirearmImageInput')
    ];
    fileInputs.forEach(function(input) {
      if (input) {
        input.addEventListener('click', function(e) {
          e.preventDefault();
          openComingSoonModal();
          return false;
        });
      }
    });
    
    // Intercept all upload container clicks for image uploads
    var uploadContainers = [
      document.getElementById('civAvatarUpload'),
      document.getElementById('vehImageUpload'),
      document.getElementById('newVehImageUpload'),
      document.getElementById('firearmImageUpload'),
      document.getElementById('newFirearmImageUpload')
    ];
    uploadContainers.forEach(function(container) {
      if (container) {
        container.addEventListener('click', function(e) {
          e.preventDefault();
          openComingSoonModal();
          return false;
        });
      }
    });
    
    // Intercept profile pic click in Account Settings modal (custom avatar)
    var accountPic = document.getElementById('accountProfilePicUpload');
    if (accountPic) {
      accountPic.addEventListener('click', function(e) {
        e.preventDefault();
        openComingSoonModal();
        return false;
      });
    }
  });
  
  function initializeProfilePictures() {
    // Handle sidebar user avatar
    var sidebarAvatar = document.getElementById('sidebarUserAvatar');
    var sidebarIcon = document.getElementById('sidebarUserIcon');
    
    if (sidebarAvatar && dbUser && dbUser.user) {
      // Check if profile picture is problematic (contains ui-avatars or similar services)
      var shouldUseDefault = !dbUser.user.profilePicture || 
                            dbUser.user.profilePicture.includes('ui-avatars') ||
                            dbUser.user.profilePicture.includes('profile-picture') ||
                            dbUser.user.profilePicture.includes('Profile Picture');
      
      if (dbUser.user.profilePicture && !shouldUseDefault) {
        // Add cache-busting parameter to prevent cached images with text
        var profilePicUrl = dbUser.user.profilePicture + (dbUser.user.profilePicture.includes('?') ? '&' : '?') + '_t=' + Date.now();
        sidebarAvatar.style.backgroundImage = `url(${profilePicUrl})`;
        if (sidebarIcon) {
          sidebarIcon.style.display = 'none';
        }
      } else {
        // Keep the default gradient background and show the user icon
        sidebarAvatar.style.backgroundImage = 'none';
        if (sidebarIcon) {
          sidebarIcon.style.display = 'block';
        }
      }
    }
    
    // Handle account settings modal profile picture
    var accountPicImg = document.getElementById('accountProfilePicImg');
    var accountPicIcon = document.getElementById('accountProfilePicIcon');
    var accountPicUpload = document.getElementById('accountProfilePicUpload');
    
    if (accountPicImg && accountPicIcon && accountPicUpload && dbUser && dbUser.user) {
      // Check if profile picture is problematic (contains ui-avatars or similar services)
      var shouldUseDefault = !dbUser.user.profilePicture || 
                            dbUser.user.profilePicture.includes('ui-avatars') ||
                            dbUser.user.profilePicture.includes('profile-picture') ||
                            dbUser.user.profilePicture.includes('Profile Picture');
      
      if (dbUser.user.profilePicture && !shouldUseDefault) {
        // Add cache-busting parameter to prevent cached images with text
        var profilePicUrl = dbUser.user.profilePicture + (dbUser.user.profilePicture.includes('?') ? '&' : '?') + '_t=' + Date.now();
        accountPicImg.src = profilePicUrl;
        accountPicImg.style.display = 'block';
        accountPicIcon.style.display = 'none';
        accountPicUpload.style.backgroundImage = `url(${profilePicUrl})`;
      } else {
        // Keep the default gradient background and show the user icon
        accountPicUpload.style.backgroundImage = 'none';
        accountPicImg.style.display = 'none';
        accountPicIcon.style.display = 'block';
      }
    }
  }
  </script>



</body>
</html>

<style>
  .civ-records-tab-btn.active {
    color: #fff !important;
    border-bottom: 3px solid #667eea !important;
  }
  .civ-records-tab-btn {
    color: #a0aec0;
    border-bottom: 3px solid transparent;
    background: none;
    outline: none;
    transition: color 0.2s, border-bottom 0.2s;
    cursor: pointer;
  }
  .civ-records-tab-btn:hover {
    color: #fff;
  }
  .civ-records-tab-content {
    width: 100%;
  }
</style>

<script>
  const API_URL = "https://police-cad-app-api-bc6d659b60b3.herokuapp.com";
</script>
